<!doctype html>
<html lang="kk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EduPhysics AI ‚Ä¢ –†–µ—Ñ–ª–µ–∫—Å–∏—è (–µ—Ä–µ–∫—à–µ)</title>
  <style>
    :root{
      --bg:#050711;
      --paper:#0c1222;
      --stroke:rgba(255,255,255,.10);
      --stroke2:rgba(255,255,255,.06);
      --text:#edf3ff;
      --muted:#a9b7d6;
      --a:#22d3ee;
      --b:#7c3aed;
      --c:#fb7185;
      --ok:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(850px 540px at 15% 10%, rgba(34,211,238,.12), transparent 55%),
        radial-gradient(850px 560px at 85% 15%, rgba(124,58,237,.14), transparent 55%),
        radial-gradient(900px 560px at 50% 95%, rgba(251,113,133,.10), transparent 55%),
        linear-gradient(180deg, #050711, #030410);
      min-height:100vh;
      padding:16px;
    }

    .wrap{max-width:980px;margin:0 auto;display:grid;gap:14px}

    .top{
      border-radius: var(--radius);
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(12,18,34,.92), rgba(10,16,32,.80));
      box-shadow: var(--shadow);
      padding:16px;
      position:relative; overflow:hidden;
    }
    .top::after{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(700px 240px at 15% 0%, rgba(34,211,238,.18), transparent 65%),
        radial-gradient(700px 260px at 90% 30%, rgba(124,58,237,.16), transparent 70%);
      pointer-events:none;
    }
    h1{margin:0;font-size:clamp(18px,2.6vw,28px)}
    .muted{color:var(--muted);font-size:13px;line-height:1.55;margin-top:8px}
    .nav{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap}
    .btn{
      cursor:pointer;
      border:1px solid var(--stroke);
      background: rgba(7,10,18,.35);
      color: var(--text);
      padding:10px 12px;
      border-radius: 14px;
      font-weight:900;
      font-size:12px;
      letter-spacing:.05em;
      text-transform:uppercase;
      transition:.18s;
      text-decoration:none;
      display:inline-flex; align-items:center; gap:8px;
    }
    .btn:hover{transform:translateY(-1px); border-color: rgba(34,211,238,.35)}
    .btn.primary{
      border:0; color:#031018;
      background: linear-gradient(90deg, var(--a), var(--b));
    }

    .grid{
      display:grid; gap:14px;
      grid-template-columns: 1fr;
    }
    @media (min-width:900px){
      .grid{grid-template-columns: 1fr 1fr}
    }

    .card{
      border-radius: var(--radius);
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(12,18,34,.92), rgba(10,16,32,.82));
      box-shadow: var(--shadow);
      padding:14px;
    }
    .card h2{
      margin:0 0 10px;
      font-size:13px;
      letter-spacing:.12em;
      text-transform:uppercase;
    }
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(7,10,18,.35);
      color:var(--muted);
      font-size:12px;
    }
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .hr{height:1px;background:var(--stroke2);margin:12px 0}

    textarea, select, input[type="text"]{
      width:100%;
      padding:10px 11px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background: rgba(7,10,18,.30);
      color: var(--text);
      outline:none;
    }
    textarea{min-height:110px;resize:vertical}
    label{display:block;margin:8px 0 6px;font-size:13px;color:rgba(237,243,255,.92)}

    .moods{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .mood{
      cursor:pointer;
      padding:12px;
      border-radius:16px;
      border:1px solid var(--stroke);
      background: rgba(7,10,18,.25);
      transition:.15s;
    }
    .mood:hover{border-color:rgba(34,211,238,.35); transform:translateY(-1px)}
    .mood.active{border-color:rgba(124,58,237,.55); background: rgba(124,58,237,.12)}
    .mood b{display:block;font-size:13px}
    .mood span{display:block;margin-top:4px;font-size:12px;color:var(--muted)}

    .meter{
      border:1px solid var(--stroke);
      border-radius: 999px;
      overflow:hidden;
      background: rgba(7,10,18,.28);
      height: 12px;
    }
    .meter > div{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--a), var(--b));
      transition: width .25s ease;
    }

    .chip{
      display:inline-flex;
      align-items:center;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(7,10,18,.25);
      cursor:pointer;
      font-weight:900;
      font-size:12px;
      margin:6px 6px 0 0;
    }
    .chip.active{border-color:rgba(34,211,238,.45); background: rgba(34,211,238,.10)}
    .suggest{
      border:1px dashed rgba(255,255,255,.18);
      background: rgba(7,10,18,.18);
      border-radius: 16px;
      padding:12px;
      color: rgba(237,243,255,.92);
      line-height:1.5;
      font-size:13px;
    }

    .small{font-size:12px;color:var(--muted)}
    pre{white-space:pre-wrap; margin:0; font-size:12px; color: rgba(237,243,255,.92)}
  </style>
</head>

<body>
<div class="wrap">
  <section class="top">
    <h1>–†–µ—Ñ–ª–µ–∫—Å–∏—è (–µ—Ä–µ–∫—à–µ —Ñ–æ—Ä–º–∞—Ç): Mood + 4R + “ö–∞—Ç–µ–ª—ñ–∫ –∫–∞—Ä—Ç–∞—Å—ã</h1>
    <p class="muted">
      –ë“±–ª –±–µ—Ç <b>—Å—Ç–∞–Ω–¥–∞—Ä—Ç—Ç–∞–Ω —Ç—ã—Å</b>: —Å–µ–Ω —ç–º–æ—Ü–∏—è“£–¥—ã –±–µ–ª–≥—ñ–ª–µ–π—Å—ñ“£, –æ–π—ã“£–¥—ã 4 –±”©–ª—ñ–º–º–µ–Ω –∂–∏–Ω–∞“õ—Ç–∞–π—Å—ã“£,
      “õ–∞–π –∂–µ—Ä–¥–µ “õ–∏–Ω–∞–ª“ì–∞–Ω—ã“£–¥—ã –∫–∞—Ä—Ç–∞ –∞—Ä“õ—ã–ª—ã –∫”©—Ä—Å–µ—Ç–µ—Å—ñ“£, –∞–ª –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Å–µ–Ω—ñ“£ –Ω”ô—Ç–∏–∂–µ–≥–µ “õ–∞—Ä–∞–π –Ω–∞“õ—Ç—ã “±—Å—ã–Ω—ã—Å –±–µ—Ä–µ–¥—ñ.
    </p>
    <div class="nav">
      <a class="btn" href="index.html">‚Üê 1-–±–µ—Ç–∫–µ “õ–∞–π—Ç—É</a>
      <button class="btn primary" id="btnCopy">–†–µ—Ñ–ª–µ–∫—Å–∏—è–Ω—ã –∫”©—à—ñ—Ä—É</button>
    </div>
  </section>

  <section class="card">
    <h2>1) –ú–µ–Ω—ñ“£ –Ω”ô—Ç–∏–∂–µ–º</h2>
    <div class="row">
      <span class="pill">–ñ–∞–ª–ø—ã: <b id="total">0</b>/100</span>
      <span class="pill">–¢–µ—Å—Ç: <b id="t">0</b>/30</span>
      <span class="pill">“ö–∞—Ç–µ: <b id="q">0</b>/30</span>
      <span class="pill">–ö—Ä–æ—Å—Å–≤–æ—Ä–¥: <b id="c">0</b>/40</span>
    </div>
    <div class="hr"></div>
    <div class="small">–ü—Ä–æ–≥—Ä–µ—Å—Å —à–∫–∞–ª–∞—Å—ã</div>
    <div class="meter" aria-label="progress meter"><div id="bar"></div></div>
    <p class="muted" id="autoComment" style="margin-top:10px;"></p>
  </section>

  <div class="grid">

    <section class="card">
      <h2>2) Mood —Ç–∞“£–¥–∞—É</h2>
      <p class="muted">“ö–∞–Ω–¥–∞–π –∫“Ø–π–¥–µ —à—ã“õ—Ç—ã“£? –ë—ñ—Ä–µ—É—ñ–Ω —Ç–∞“£–¥–∞.</p>
      <div class="moods" id="moods">
        <div class="mood" data-m="üî•"><b>üî• “ö—É–∞—Ç—Ç—ã–º—ã–Ω</b><span>–ë”ô—Ä—ñ–Ω —Å–µ–Ω—ñ–º–¥—ñ –æ—Ä—ã–Ω–¥–∞–¥—ã–º</span></div>
        <div class="mood" data-m="üôÇ"><b>üôÇ –ñ–∞“õ—Å—ã</b><span>–ñ–∞–ª–ø—ã —Ç“Ø—Å—ñ–Ω–¥—ñ–º, –∞–∑–¥–∞–ø “õ–∞—Ç–µ –±–∞—Ä</span></div>
        <div class="mood" data-m="üò∂"><b>üò∂ –ë–µ–π—Ç–∞—Ä–∞–ø</b><span>–û—Ä—Ç–∞—à–∞, “õ–∞–π—Ç–∞–ª–∞—É –∫–µ—Ä–µ–∫</span></div>
        <div class="mood" data-m="üòï"><b>üòï “ö–∏—ã–Ω–¥–∞—É</b><span>–ö–µ–π –∂–µ—Ä—ñ —Ç“Ø—Å—ñ–Ω—ñ–∫—Å—ñ–∑</span></div>
        <div class="mood" data-m="üò£"><b>üò£ “ö–∏–Ω–∞–ª–¥—ã–º</b><span>–ö”©–º–µ–∫ –∫–µ—Ä–µ–∫ –±–æ–ª–¥—ã</span></div>
        <div class="mood" data-m="üöÄ"><b>üöÄ –ú–∞“õ—Å–∞—Ç—ã–º –±–∞—Ä</b><span>–ö–µ–ª–µ—Å—ñ–¥–µ –∂–∞“õ—Å—ã—Ä–∞“õ –∂–∞—Å–∞–π–º—ã–Ω</span></div>
      </div>
      <div class="hr"></div>
      <label>–ë“Ø–≥—ñ–Ω–≥—ñ –±—ñ—Ä —Å”©–π–ª–µ–º–¥—ñ–∫ “õ–æ—Ä—ã—Ç—ã–Ω–¥—ã</label>
      <input id="oneLine" type="text" placeholder="–ú—ã—Å–∞–ª—ã: –ë“Ø–≥—ñ–Ω –º–∞–≥–Ω–∏—Ç ”©—Ä—ñ—Å—ñ–Ω—ñ“£ –∫“Ø—à —Å—ã–∑—ã“õ—Ç–∞—Ä—ã–Ω—ã“£ –±–∞“ì—ã—Ç—ã–Ω –Ω–∞“õ—Ç—ã —Ç“Ø—Å—ñ–Ω–¥—ñ–º." />
    </section>

    <section class="card">
      <h2>3) “ö–∞—Ç–µ–ª—ñ–∫ –∫–∞—Ä—Ç–∞—Å—ã</h2>
      <p class="muted">“ö–∞–π –±”©–ª—ñ–º “õ–∏–Ω–∞–ª–¥—ã—Ä–¥—ã? –ë—ñ—Ä–Ω–µ—à–µ—É—ñ–Ω –±–µ–ª–≥—ñ–ª–µ–π –∞–ª–∞—Å—ã“£.</p>
      <div id="chips"></div>
      <div class="hr"></div>
      <label>–ï“£ –∂–∏—ñ “õ–∞—Ç–µ –∂—ñ–±–µ—Ä–≥–µ–Ω—ñ–º</label>
      <textarea id="mistake" placeholder="“ö–∞–π –∂–µ—Ä–¥–µ “õ–∞—Ç–µ –∫–µ—Ç–µ–¥—ñ? –ù–µ–≥–µ?"></textarea>
      <label>–û–Ω—ã “õ–∞–ª–∞–π —Ç“Ø–∑–µ—Ç–µ–º?</label>
      <textarea id="fix" placeholder="“ö–∞–Ω–¥–∞–π “õ–∞–¥–∞–º –∂–∞—Å–∞–π–º—ã–Ω? (–º—ã—Å: –∞–Ω—ã“õ—Ç–∞–º–∞ –æ“õ—É, 5 —Å“±—Ä–∞“õ —à—ã“ì–∞—Ä—É, –∫—Ä–æ—Å—Å–≤–æ—Ä–¥—Ç–∞ 2 —Å”©–∑–¥—ñ “õ–∞–π—Ç–∞ –∂–∞—Å–∞—É)"></textarea>
    </section>

  </div>

  <section class="card">
    <h2>4) 4R —Ä–µ—Ñ–ª–µ–∫—Å–∏—è—Å—ã (–µ—Ä–µ–∫—à–µ —Ñ–æ—Ä–º–∞—Ç)</h2>
    <p class="muted">
      4R = <b>Recall</b> (–Ω–µ —ñ—Å—Ç–µ–¥—ñ–º), <b>Reason</b> (–Ω–µ–≥–µ —Å–æ–ª–∞–π –±–æ–ª–¥—ã),
      <b>Refine</b> (“õ–∞–ª–∞–π –∂–∞“õ—Å–∞—Ä—Ç–∞–º), <b>Roadmap</b> (–∫–µ–ª–µ—Å—ñ –∂–æ—Å–ø–∞—Ä).
    </p>

    <label>Recall ‚Äî –±“Ø–≥—ñ–Ω “õ–∞–Ω–¥–∞–π 2 —Ç–∞–ø—Å—ã—Ä–º–∞ –æ—Ä—ã–Ω–¥–∞–¥—ã–º?</label>
    <textarea id="r1" placeholder="–ú—ã—Å–∞–ª—ã: –º–∏–Ω–∏-—Ç–µ—Å—Ç, ‚Äú“ö–∞—Ç–µ “õ–∞–π–¥–∞?‚Äù, –∫—Ä–æ—Å—Å–≤–æ—Ä–¥..."></textarea>

    <label>Reason ‚Äî –∂–∞“õ—Å—ã/“õ–∏—ã–Ω –±–æ–ª“ì–∞–Ω —Å–µ–±–µ–±—ñ –Ω–µ–¥–µ?</label>
    <textarea id="r2" placeholder="–ú—ã—Å–∞–ª—ã: N‚ÜíS –±–∞“ì—ã—Ç—ã–Ω –±—ñ–ª–µ–º, –±—ñ—Ä–∞“õ —Ñ–µ—Ä—Ä–æ–º–∞–≥–Ω–µ—Ç–∏–∑–º —Å”©–∑—ñ–Ω —à–∞—Ç–∞—Å—Ç—ã—Ä–¥—ã–º..."></textarea>

    <label>Refine ‚Äî –∫–µ–ª–µ—Å—ñ–¥–µ –∂–∞“õ—Å–∞—Ä—Ç—É “Ø—à—ñ–Ω 2 ”ô—Ä–µ–∫–µ—Ç</label>
    <textarea id="r3" placeholder="1) ...  2) ..."></textarea>

    <label>Roadmap ‚Äî 10 –º–∏–Ω—É—Ç—Ç—ã“õ –∂–æ—Å–ø–∞—Ä (–Ω–∞“õ—Ç—ã)</label>
    <textarea id="r4" placeholder="–ú—ã—Å–∞–ª—ã: 3 –º–∏–Ω –∞–Ω—ã“õ—Ç–∞–º–∞, 4 –º–∏–Ω 5 —Å“±—Ä–∞“õ, 3 –º–∏–Ω –∫—Ä–æ—Å—Å–≤–æ—Ä–¥ “õ–∞–π—Ç–∞ —Ç–µ–∫—Å–µ—Ä—É"></textarea>

    <div class="hr"></div>
    <h2>5) –ê–≤—Ç–æ-“±—Å—ã–Ω—ã—Å</h2>
    <div class="suggest" id="suggest"></div>

    <div class="hr"></div>
    <div class="row">
      <button class="btn primary" id="btnSave">–°–∞“õ—Ç–∞—É</button>
      <span class="pill">–°–∞“õ—Ç–∞–ª–¥—ã: <b id="saved">0</b></span>
    </div>

    <div class="hr"></div>
    <div class="small">–ö”©—à—ñ—Ä—É–≥–µ –¥–∞–π—ã–Ω –º”ô—Ç—ñ–Ω (–∞–ø–∞–π“ì–∞/–µ—Å–µ–ø–∫–µ):</div>
    <pre id="out"></pre>
  </section>

</div>

<script>
  const $ = (id)=>document.getElementById(id);
  const clamp=(x,min,max)=>Math.max(min,Math.min(max,x));

  // 1-–±–µ—Ç—Ç–µ–Ω –∫–µ–ª–≥–µ–Ω “±–ø–∞–π–ª–∞—Ä–¥—ã –æ“õ–∏–º—ã–∑
  const raw = localStorage.getItem("edu_magnet_state");
  let s = {testScore:0, taskScore:0, cwScore:0, traffic:""};
  try{ if(raw) s = {...s, ...JSON.parse(raw)}; }catch(e){}

  const total = (s.testScore||0) + (s.taskScore||0) + (s.cwScore||0);

  $("t").textContent = s.testScore||0;
  $("q").textContent = s.taskScore||0;
  $("c").textContent = s.cwScore||0;
  $("total").textContent = total;
  $("bar").style.width = clamp(total,0,100) + "%";

  // –∞–≤—Ç–æ-–∫–æ–º–º–µ–Ω—Ç
  const auto = $("autoComment");
  if(total >= 85) auto.textContent = "–ñ–æ“ì–∞—Ä—ã –Ω”ô—Ç–∏–∂–µ! –°–µ–Ω –Ω–µ–≥—ñ–∑–≥—ñ “±“ì—ã–º–¥–∞—Ä–¥—ã –¥–∞, —Ç–µ—Ä–º–∏–Ω–¥–µ—Ä–¥—ñ –¥–µ –∂–∞“õ—Å—ã –º–µ“£–≥–µ—Ä–≥–µ–Ω—Å—ñ“£.";
  else if(total >= 60) auto.textContent = "–ñ–∞“õ—Å—ã! –ö–µ–π–±—ñ—Ä —Ç“±—Å—Ç–∞—Ä–¥—ã “õ–∞–π—Ç–∞–ª–∞—Å–∞“£, –¥–µ“£–≥–µ–π—ñ“£ —Ç–µ–∑ ”©—Å–µ–¥—ñ.";
  else auto.textContent = "–ë–∞—Å—Ç–∞–ø“õ—ã –¥–µ“£–≥–µ–π. –£–∞–π—ã–º–¥–∞–º–∞: —Ç”©–º–µ–Ω–¥–µ–≥—ñ –∂–æ—Å–ø–∞—Ä –∫”©–º–µ–∫—Ç–µ—Å–µ–¥—ñ ‚Äî –∞–∑ “õ–∞–¥–∞–º–º–µ–Ω –∫”©—Ç–µ—Ä–µ–º—ñ–∑.";

  // chips (“õ–∞—Ç–µ–ª—ñ–∫ –∫–∞—Ä—Ç–∞—Å—ã)
  const chipData = [
    {id:"def", label:"–ê–Ω—ã“õ—Ç–∞–º–∞–ª–∞—Ä"},
    {id:"dir", label:"N‚ÜíS –±–∞“ì—ã—Ç—ã"},
    {id:"pol", label:"–ü–æ–ª—é—Å—Ç–µ—Ä ”ô—Å–µ—Ä–ª–µ—Å—É—ñ"},
    {id:"dens",label:"–°—ã–∑—ã“õ —Ç—ã“ì—ã–∑–¥—ã“ì—ã"},
    {id:"mat", label:"–ú–∞—Ç–µ—Ä–∏–∞–ª–¥–∞—Ä (–±–æ–ª–∞—Ç, –Ω–∏–∫–µ–ª—å)"},
    {id:"terms",label:"–¢–µ—Ä–º–∏–Ω–¥–µ—Ä (–∫—Ä–æ—Å—Å–≤–æ—Ä–¥)"},
  ];

  const chipBox = $("chips");
  const chosen = new Set();

  chipData.forEach(x=>{
    const el=document.createElement("span");
    el.className="chip";
    el.textContent = x.label;
    el.dataset.id = x.id;
    el.addEventListener("click", ()=>{
      if(chosen.has(x.id)){ chosen.delete(x.id); el.classList.remove("active"); }
      else { chosen.add(x.id); el.classList.add("active"); }
      updateSuggest();
      buildOut();
    });
    chipBox.appendChild(el);
  });

  // moods
  let mood = "";
  document.querySelectorAll(".mood").forEach(el=>{
    el.addEventListener("click", ()=>{
      document.querySelectorAll(".mood").forEach(x=>x.classList.remove("active"));
      el.classList.add("active");
      mood = el.dataset.m;
      updateSuggest();
      buildOut();
    });
  });

  function updateSuggest(){
    const sug = $("suggest");
    // “±–ø–∞–π“ì–∞ “õ–∞—Ä–∞–π “±—Å—ã–Ω—ã—Å
    let base = "";
    if(total >= 85) base = "–°–µ–Ω–¥–µ –±”ô—Ä—ñ –∂–∞“õ—Å—ã! –ï–Ω–¥—ñ –±—ñ–ª—ñ–º–¥—ñ –±–µ–∫—ñ—Ç—É “Ø—à—ñ–Ω 1 –Ω–∞“õ—Ç—ã –º—ã—Å–∞–ª –∞–π—Ç—ã–ø, 1 “õ—ã—Å“õ–∞ —Å—Ö–µ–º–∞ —Å—ã–∑—Å–∞“£ –∂–µ—Ç–µ–¥—ñ.";
    else if(total >= 60) base = "–ö–µ–ª–µ—Å—ñ “õ–∞–¥–∞–º: ”ô–ª—Å—ñ–∑ –±”©–ª—ñ–º–¥—ñ —Ç–∞“£–¥–∞–ø, 5 —Ç–µ–∑ —Å“±—Ä–∞“õ + –∫—Ä–æ—Å—Å–≤–æ—Ä–¥—Ç–∞“ì—ã 2 —Å”©–∑–¥—ñ “õ–∞–π—Ç–∞ —Ç–µ–∫—Å–µ—Ä.";
    else base = "“ö–∞–¥–∞–º–¥–∞–ø –∂–æ—Å–ø–∞—Ä: 1) –∞–Ω—ã“õ—Ç–∞–º–∞ –æ“õ—É (3 –º–∏–Ω), 2) N‚ÜíS –±–∞“ì—ã—Ç—ã (2 –º–∏–Ω), 3) 5 —Å“±—Ä–∞“õ (3 –º–∏–Ω), 4) –∫—Ä–æ—Å—Å–≤–æ—Ä–¥ (2 –º–∏–Ω).";

    const focus = chosen.size ? ("–ù–∞–∑–∞—Ä –∞—É–¥–∞—Ä–∞—Ç—ã–Ω –±”©–ª—ñ–º(–¥–µ—Ä): " + [...chosen].map(id=>chipData.find(x=>x.id===id)?.label).filter(Boolean).join(", ") + ".")
                             : "–ù–∞–∑–∞—Ä –∞—É–¥–∞—Ä–∞—Ç—ã–Ω –±”©–ª—ñ–º: ”©–∑—ñ“£ —Ç–∞“£–¥–∞ (—á–∏–ø—Ç–µ—Ä –∞—Ä“õ—ã–ª—ã).";

    const moodLine = mood ? `–ö“Ø–π—ñ–º: ${mood}.` : "–ö“Ø–π—ñ–º: —Ç–∞“£–¥–∞–ª–º–∞–¥—ã.";
    sug.innerHTML = `<b>–ê–≤—Ç–æ-“±—Å—ã–Ω—ã—Å:</b> ${base}<br><br>${focus}<br>${moodLine}`;
  }

  // build output text
  function buildOut(){
    const one = $("oneLine").value.trim() || "(–∂–∞–∑—ã–ª–º–∞–¥—ã)";
    const m1 = $("mistake").value.trim() || "(–∂–∞–∑—ã–ª–º–∞–¥—ã)";
    const f1 = $("fix").value.trim() || "(–∂–∞–∑—ã–ª–º–∞–¥—ã)";
    const r1 = $("r1").value.trim() || "(–∂–∞–∑—ã–ª–º–∞–¥—ã)";
    const r2 = $("r2").value.trim() || "(–∂–∞–∑—ã–ª–º–∞–¥—ã)";
    const r3 = $("r3").value.trim() || "(–∂–∞–∑—ã–ª–º–∞–¥—ã)";
    const r4 = $("r4").value.trim() || "(–∂–∞–∑—ã–ª–º–∞–¥—ã)";

    const focus = chosen.size ? [...chosen].map(id=>chipData.find(x=>x.id===id)?.label).filter(Boolean).join(", ") : "(—Ç–∞“£–¥–∞–ª–º–∞–¥—ã)";

    const text =
`EduPhysics AI ‚Äî –†–µ—Ñ–ª–µ–∫—Å–∏—è (–¢“±—Ä–∞“õ—Ç—ã –º–∞–≥–Ω–∏—Ç—Ç–µ—Ä)

–ù”ô—Ç–∏–∂–µ: ${total}/100
- –¢–µ—Å—Ç: ${s.testScore||0}/30
- ‚Äú“ö–∞—Ç–µ “õ–∞–π–¥–∞?‚Äù: ${s.taskScore||0}/30
- –ö—Ä–æ—Å—Å–≤–æ—Ä–¥: ${s.cwScore||0}/40

Mood: ${mood || "(—Ç–∞“£–¥–∞–ª–º–∞–¥—ã)"}
–ë—ñ—Ä —Å”©–π–ª–µ–º: ${one}

“ö–∞—Ç–µ–ª—ñ–∫ –∫–∞—Ä—Ç–∞—Å—ã: ${focus}
–ï“£ –∂–∏—ñ “õ–∞—Ç–µ: ${m1}
–¢“Ø–∑–µ—Ç—É –∂–æ–ª—ã: ${f1}

4R:
Recall: ${r1}
Reason: ${r2}
Refine: ${r3}
Roadmap: ${r4}
`;
    $("out").textContent = text;
  }

  // update on typing
  ["oneLine","mistake","fix","r1","r2","r3","r4"].forEach(id=>{
    $(id).addEventListener("input", buildOut);
  });

  // save
  let savedCount = 0;
  $("btnSave").addEventListener("click", ()=>{
    savedCount += 1;
    $("saved").textContent = savedCount;
    localStorage.setItem("edu_magnet_reflection", JSON.stringify({
      total, scores: s, mood,
      oneLine: $("oneLine").value,
      chosen: [...chosen],
      mistake: $("mistake").value,
      fix: $("fix").value,
      r1:$("r1").value, r2:$("r2").value, r3:$("r3").value, r4:$("r4").value,
      savedAt: new Date().toISOString()
    }));
    buildOut();
  });

  // copy
  $("btnCopy").addEventListener("click", ()=>{
    buildOut();
    const txt = $("out").textContent;
    navigator.clipboard?.writeText(txt).catch(()=>{});
  });

  // init suggestions & out
  updateSuggest();
  buildOut();

  // load previous reflection if any
  const prevRaw = localStorage.getItem("edu_magnet_reflection");
  if(prevRaw){
    try{
      const prev = JSON.parse(prevRaw);
      $("oneLine").value = prev.oneLine || "";
      $("mistake").value = prev.mistake || "";
      $("fix").value = prev.fix || "";
      $("r1").value = prev.r1 || "";
      $("r2").value = prev.r2 || "";
      $("r3").value = prev.r3 || "";
      $("r4").value = prev.r4 || "";
      (prev.chosen||[]).forEach(id=>{
        chosen.add(id);
        document.querySelectorAll(".chip").forEach(ch=>{
          if(ch.dataset.id===id) ch.classList.add("active");
        });
      });
      mood = prev.mood || "";
      if(mood){
        document.querySelectorAll(".mood").forEach(m=>{
          if(m.dataset.m===mood) m.classList.add("active");
        });
      }
      updateSuggest();
      buildOut();
    }catch(e){}
  }
</script>
</body>
</html>
