<!doctype html>
<html lang="kk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–¢“±—Ä–∞“õ—Ç—ã –º–∞–≥–Ω–∏—Ç—Ç–µ—Ä ‚Äî “ö–ú–ñ —Ç–∞–ø—Å—ã—Ä–º–∞–ª–∞—Ä (1-–±–µ—Ç)</title>
  <style>
    :root{
      --bg1:#f6f1e7;     /* –±–µ–∂ */
      --bg2:#efe2cf;
      --card:rgba(255,255,255,.72);
      --stroke:rgba(70,40,20,.16);
      --text:#2b1d14;
      --muted:#6a4f3d;

      --ok:#2e7d32;
      --warn:#b26a00;
      --bad:#b00020;

      --accent:#7a4b2a;
      --accent2:#c57f4a;

      --shadow:0 18px 45px rgba(45,25,10,.14);
      --shadow2:0 10px 28px rgba(45,25,10,.10);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:
        radial-gradient(1100px 520px at 20% 10%, rgba(197,127,74,.22), transparent 60%),
        radial-gradient(900px 480px at 80% 25%, rgba(122,75,42,.18), transparent 55%),
        linear-gradient(180deg,var(--bg1),var(--bg2));
      min-height:100vh;
    }

    header{
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(10px);
      background: rgba(246,241,231,.78);
      border-bottom:1px solid var(--stroke);
    }
    .head{
      max-width:1100px; margin:0 auto; padding:14px 16px;
      display:flex; gap:14px; align-items:center; justify-content:space-between;
      flex-wrap:wrap;
    }
    .title{
      display:flex; flex-direction:column; gap:2px;
    }
    .title h1{margin:0; font-size:16px; letter-spacing:.2px}
    .title p{margin:0; color:var(--muted); font-size:12.5px}

    nav{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .navlink{
      text-decoration:none;
      color:var(--text);
      font-weight:700;
      font-size:12.5px;
      padding:9px 12px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.55);
      box-shadow: var(--shadow2);
    }
    .navlink.primary{
      background: linear-gradient(135deg, rgba(197,127,74,.35), rgba(122,75,42,.18));
    }

    main{max-width:1100px; margin:0 auto; padding:16px; display:grid; gap:14px;}
    .grid{display:grid; gap:14px; grid-template-columns:1fr;}
    @media (min-width:980px){ .grid{grid-template-columns:1.25fr .75fr;} }

    .card{
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:18px;
      padding:14px;
      box-shadow: var(--shadow);
    }
    .card h2{margin:0 0 10px; font-size:15px}
    .muted{color:var(--muted); font-size:13px; margin:0 0 10px}

    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px; border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.55);
      color:var(--muted);
      font-size:12px;
    }

    .btn{
      cursor:pointer;
      border:0;
      border-radius:14px;
      padding:10px 12px;
      font-weight:800;
      color:var(--text);
      background: rgba(255,255,255,.65);
      border:1px solid var(--stroke);
      box-shadow: var(--shadow2);
    }
    .btn:hover{transform: translateY(-1px); filter: brightness(1.02);}
    .btn.primary{
      background: linear-gradient(135deg, rgba(197,127,74,.45), rgba(122,75,42,.22));
    }
    .btn.ghost{background: transparent;}

    .hr{height:1px; background: var(--stroke); margin:12px 0}

    .task-img{
      width:100%;
      max-width:920px;
      height:auto;
      display:block;
      margin:10px auto;
      border-radius:14px;
      border:1px solid var(--stroke);
      box-shadow: var(--shadow2);
    }

    .q{
      padding:12px;
      border:1px solid var(--stroke);
      border-radius:16px;
      background: rgba(255,255,255,.55);
      margin:10px 0;
    }
    label{display:block; margin:6px 0; font-size:13px;}
    input[type="text"], select, textarea{
      width:100%;
      padding:10px 10px;
      border-radius:14px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.65);
      color:var(--text);
      outline:none;
    }
    textarea{min-height:90px; resize:vertical;}

    .crit{
      display:grid; gap:10px;
    }
    .crit .item{
      padding:10px;
      border:1px dashed var(--stroke);
      border-radius:16px;
      background: rgba(255,255,255,.52);
      display:flex; justify-content:space-between; gap:10px; align-items:flex-start;
    }
    .tag{
      font-weight:900; font-size:12px;
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.7);
      white-space:nowrap;
    }
    .tag.ok{color:var(--ok)}
    .tag.warn{color:var(--warn)}
    .tag.bad{color:var(--bad)}

    .scoreBox{
      display:flex; justify-content:space-between; align-items:baseline; gap:12px; flex-wrap:wrap;
      padding:12px; border-radius:18px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.55);
    }
    .bigScore{font-size:34px; font-weight:1000; letter-spacing:.5px;}

    /* Mini question cards */
    .cards{
      display:grid; gap:10px;
      grid-template-columns:repeat(1,1fr);
    }
    @media(min-width:720px){ .cards{grid-template-columns:repeat(2,1fr);} }
    .flash{
      border:1px solid var(--stroke);
      border-radius:18px;
      padding:12px;
      background: rgba(255,255,255,.62);
      box-shadow: var(--shadow2);
      position:relative;
      overflow:hidden;
    }
    .flash b{display:block; margin-bottom:6px}
    .flash .ans{
      margin-top:8px;
      padding:10px;
      border-radius:14px;
      background: rgba(197,127,74,.18);
      border:1px solid rgba(197,127,74,.28);
      display:none;
    }
    .flash.show .ans{display:block;}
    .flash .miniBtn{
      margin-top:8px;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.7);
      cursor:pointer;
      font-weight:900;
      font-size:12px;
    }

    /* Crossword theme (beige) */
    .cw-wrap{display:grid; gap:12px;}
    .cw-grid{
      display:inline-grid;
      gap:1px;
      background: rgba(70,40,20,.18);
      border:1px solid rgba(70,40,20,.18);
      border-radius:10px;
      overflow:hidden;
      width:max-content;
      max-width:100%;
    }
    .cw-cell{
      width:36px; height:36px;
      background: rgba(255,255,255,.45);
      position:relative;
    }
    .cw-cell.active{background: rgba(255,255,255,.72);}
    .cw-cell.correct{background: rgba(46,125,50,.14);}
    .cw-cell.wrong{background: rgba(176,0,32,.12);}
    .cw-cell .num{
      position:absolute; top:2px; left:4px;
      font-size:9px; font-weight:900; color: var(--accent);
      pointer-events:none;
    }
    .cw-cell input{
      width:100%; height:100%;
      border:0; outline:none;
      background:transparent;
      text-align:center;
      font-weight:1000;
      font-size:14px;
      text-transform:uppercase;
      color:var(--text);
      padding-top:10px;
    }
    .cw-clues{
      display:grid; gap:10px;
      grid-template-columns:1fr;
    }
    @media(min-width:980px){ .cw-clues{grid-template-columns:1fr 1fr;} }
    .cw-box{
      border:1px solid var(--stroke);
      border-radius:18px;
      padding:12px;
      background: rgba(255,255,255,.55);
    }
    .cw-box h3{margin:0 0 8px; font-size:13px; letter-spacing:.4px}
    .cw-item{
      padding:6px 8px; border-radius:12px;
      border:1px solid rgba(70,40,20,.10);
      background: rgba(255,255,255,.62);
      margin:6px 0;
      cursor:pointer;
      font-size:12.5px;
      color:var(--muted);
    }
    .cw-item:hover{filter:brightness(1.02)}
    .small{font-size:12px; color:var(--muted)}
  </style>
</head>

<body>
<header>
  <div class="head">
    <div class="title">
      <h1>–¢“±—Ä–∞“õ—Ç—ã –º–∞–≥–Ω–∏—Ç—Ç–µ—Ä ‚Äî “ö–ú–ñ —Ç–∞–ø—Å—ã—Ä–º–∞–ª–∞—Ä (1-–±–µ—Ç)</h1>
      <p>–°—É—Ä–µ—Ç—Ç—ñ —Ç–∞–ø—Å—ã—Ä–º–∞–ª–∞—Ä + –º–∏–Ω–∏ —Ç–µ—Å—Ç + –º–∏–Ω–∏ —Å“±—Ä–∞“õ—Ç–∞—Ä + –∫—Ä–æ—Å—Å–≤–æ—Ä–¥ + –∫—Ä–∏—Ç–µ—Ä–∏–π (10 –±–∞–ª–ª)</p>
    </div>
    <nav>
      <a class="navlink primary" href="index.html">1-–±–µ—Ç: —Ç–∞–ø—Å—ã—Ä–º–∞–ª–∞—Ä</a>
      <a class="navlink" href="reflection.html">2-–±–µ—Ç: —Ä–µ—Ñ–ª–µ–∫—Å–∏—è</a>
    </nav>
  </div>
</header>

<main>
  <div class="grid">

    <!-- LEFT -->
    <section class="card">
      <h2>–ë–∞“ì–∞–ª–∞—É –∫—Ä–∏—Ç–µ—Ä–∏–π–ª–µ—Ä—ñ (10 –±–∞–ª–ª —à–∫–∞–ª–∞)</h2>
      <p class="muted">–ú“±“ì–∞–ª—ñ–º–≥–µ –∫”©—Ä—Å–µ—Ç—É–≥–µ —ã“£“ì–∞–π–ª—ã: ”ô—Ä —Ç–∞–ø—Å—ã—Ä–º–∞ –±”©–ª–µ–∫ –±–∞“ì–∞–ª–∞–Ω–∞–¥—ã.</p>

      <div class="crit">
        <div class="item">
          <div>
            <b>1) –ú–∏–Ω–∏-—Ç–µ—Å—Ç (3 —Å“±—Ä–∞“õ)</b>
            <div class="small">”ò—Ä –¥“±—Ä—ã—Å –∂–∞—É–∞–ø ‚Äî 1 –±–∞–ª–ª</div>
          </div>
          <span class="tag">3 –±–∞–ª–ª</span>
        </div>

        <div class="item">
          <div>
            <b>2) “ö–ú–ñ: –ö–æ–º–ø–∞—Å—Ç—ã –¥“±—Ä—ã—Å –æ—Ä–Ω–∞–ª–∞—Å—Ç—ã—Ä (X, Y, Z, T)</b>
            <div class="small">–ë–∞—Ä–ª—ã“ì—ã –¥“±—Ä—ã—Å –±–æ–ª—Å–∞ ‚Äî 2 –±–∞–ª–ª</div>
          </div>
          <span class="tag">2 –±–∞–ª–ª</span>
        </div>

        <div class="item">
          <div>
            <b>3) “ö–ú–ñ: –ö“Ø—à —Å—ã–∑—ã“õ—Ç–∞—Ä—ã –¥“±—Ä—ã—Å —Å—É—Ä–µ—Ç—Ç—ñ —Ç–∞“£–¥–∞</b>
            <div class="small">–î“±—Ä—ã—Å –∂–∞—É–∞–ø ‚Äî 2 –±–∞–ª–ª</div>
          </div>
          <span class="tag">2 –±–∞–ª–ª</span>
        </div>

        <div class="item">
          <div>
            <b>4) “ö–ú–ñ: –ü–æ–ª—é—Å—Ç–µ—Ä—ñ–Ω –∞–Ω—ã“õ—Ç–∞</b>
            <div class="small">–ë–∞—Ä–ª—ã“ì—ã –¥“±—Ä—ã—Å –±–æ–ª—Å–∞ ‚Äî 2 –±–∞–ª–ª</div>
          </div>
          <span class="tag">2 –±–∞–ª–ª</span>
        </div>

        <div class="item">
          <div>
            <b>5) –ö—Ä–æ—Å—Å–≤–æ—Ä–¥</b>
            <div class="small">–ë–∞—Ä–ª—ã“ì—ã –¥“±—Ä—ã—Å ‚Äî 1 –±–∞–ª–ª</div>
          </div>
          <span class="tag">1 –±–∞–ª–ª</span>
        </div>
      </div>

      <div class="hr"></div>

      <div class="scoreBox">
        <div>
          <div class="muted">–ñ–∞–ª–ø—ã “±–ø–∞–π</div>
          <div class="bigScore"><span id="total">0</span> / 10</div>
          <div class="small" id="levelText">–î–µ“£–≥–µ–π: ‚Äî</div>
        </div>
        <div class="row">
          <button class="btn primary" id="btnCalc">“∞–ø–∞–π–¥—ã –µ—Å–µ–ø—Ç–µ—É</button>
          <button class="btn" id="btnReset">–¢–∞–∑–∞–ª–∞—É</button>
        </div>
      </div>

      <div class="hr"></div>

      <h2>1) –ú–∏–Ω–∏-—Ç–µ—Å—Ç (–∞–≤—Ç–æ)</h2>
      <p class="muted">–¢–∞“õ—ã—Ä—ã–ø: —Ç“±—Ä–∞“õ—Ç—ã –º–∞–≥–Ω–∏—Ç, –ø–æ–ª—é—Å, –∫“Ø—à —Å—ã–∑—ã“õ—Ç–∞—Ä—ã –±–∞“ì—ã—Ç—ã.</p>

      <div class="q">
        <div><b>1.</b> –ö“Ø—à —Å—ã–∑—ã“õ—Ç–∞—Ä—ã —Å—ã—Ä—Ç“õ—ã –∫–µ“£—ñ—Å—Ç—ñ–∫—Ç–µ “õ–∞–π –±–∞“ì—ã—Ç—Ç–∞ –±–æ–ª–∞–¥—ã?</div>
        <label><input type="radio" name="t1" value="a"> S ‚Üí N</label>
        <label><input type="radio" name="t1" value="b"> N ‚Üí S</label>
        <label><input type="radio" name="t1" value="c"> –ë–∞“ì—ã—Ç—ã –±–æ–ª–º–∞–π–¥—ã</label>
      </div>

      <div class="q">
        <div><b>2.</b> “∞“õ—Å–∞—Å (–∞—Ç—Ç–∞—Å) –ø–æ–ª—é—Å—Ç–µ—Ä “õ–∞–ª–∞–π ”ô—Å–µ—Ä–ª–µ—Å–µ–¥—ñ?</div>
        <label><input type="radio" name="t2" value="a"> –¢–∞—Ä—Ç—ã–ª–∞–¥—ã</label>
        <label><input type="radio" name="t2" value="b"> –¢–µ–±—ñ–ª–µ–¥—ñ</label>
        <label><input type="radio" name="t2" value="c"> ”ò—Å–µ—Ä–ª–µ—Å–ø–µ–π–¥—ñ</label>
      </div>

      <div class="q">
        <div><b>3.</b> –ö“Ø—à —Å—ã–∑—ã“õ—Ç–∞—Ä—ã ‚Äú—Ç—ã“ì—ã–∑‚Äù –±–æ–ª—Å–∞, –Ω–µ–Ω—ñ –±—ñ–ª–¥—ñ—Ä–µ–¥—ñ?</div>
        <label><input type="radio" name="t3" value="a"> ”®—Ä—ñ—Å ”ô–ª—Å—ñ–∑</label>
        <label><input type="radio" name="t3" value="b"> ”®—Ä—ñ—Å –∫“Ø—à—Ç—ñ—Ä–µ–∫</label>
        <label><input type="radio" name="t3" value="c"> –ú–∞–≥–Ω–∏—Ç –∂–æ“õ</label>
      </div>

      <div class="row">
        <span class="pill">–¢–µ—Å—Ç “±–ø–∞–π—ã: <b id="testScore">0</b>/3</span>
        <button class="btn primary" id="btnTest">–¢–µ—Å—Ç—Ç—ñ —Ç–µ–∫—Å–µ—Ä—É</button>
      </div>

      <div class="hr"></div>

      <h2>2) “ö–ú–ñ —Ç–∞–ø—Å—ã—Ä–º–∞—Å—ã: –ö–æ–º–ø–∞—Å—Ç—ã –¥“±—Ä—ã—Å –æ—Ä–Ω–∞–ª–∞—Å—Ç—ã—Ä</h2>
      <p class="muted">–°—É—Ä–µ—Ç—Ç–µ–≥—ñ –º–∞–≥–Ω–∏—Ç ”©—Ä—ñ—Å—ñ–Ω–µ —Å–∞–π –∫–æ–º–ø–∞—Å —Ç—ñ–ª—ñ–Ω—ñ“£ –±–∞“ì—ã—Ç—ã–Ω —Ç–∞“£–¥–∞ (X, Y, Z, T).</p>
      <img src="compas.jpg" alt="“ö–ú–ñ: –∫–æ–º–ø–∞—Å—Ç—ã –¥“±—Ä—ã—Å –æ—Ä–Ω–∞–ª–∞—Å—Ç—ã—Ä" class="task-img">

      <div class="q">
        <div class="small">–¢–∞“£–¥–∞—É: ‚üµ —Å–æ–ª“ì–∞ | ‚ü∂ –æ“£“ì–∞ | ‚ü∞ –∂–æ“ì–∞—Ä—ã | ‚ü± —Ç”©–º–µ–Ω</div>
        <label>X –Ω“Ø–∫—Ç–µ—Å—ñ–Ω–¥–µ —Ç—ñ–ª –±–∞“ì—ã—Ç—ã:
          <select id="cx">
            <option value="">–¢–∞“£–¥–∞‚Ä¶</option>
            <option value="L">‚üµ —Å–æ–ª“ì–∞</option>
            <option value="R">‚ü∂ –æ“£“ì–∞</option>
            <option value="U">‚ü∞ –∂–æ“ì–∞—Ä—ã</option>
            <option value="D">‚ü± —Ç”©–º–µ–Ω</option>
          </select>
        </label>

        <label>Y –Ω“Ø–∫—Ç–µ—Å—ñ–Ω–¥–µ —Ç—ñ–ª –±–∞“ì—ã—Ç—ã:
          <select id="cy">
            <option value="">–¢–∞“£–¥–∞‚Ä¶</option>
            <option value="L">‚üµ —Å–æ–ª“ì–∞</option>
            <option value="R">‚ü∂ –æ“£“ì–∞</option>
            <option value="U">‚ü∞ –∂–æ“ì–∞—Ä—ã</option>
            <option value="D">‚ü± —Ç”©–º–µ–Ω</option>
          </select>
        </label>

        <label>Z –Ω“Ø–∫—Ç–µ—Å—ñ–Ω–¥–µ —Ç—ñ–ª –±–∞“ì—ã—Ç—ã:
          <select id="cz">
            <option value="">–¢–∞“£–¥–∞‚Ä¶</option>
            <option value="L">‚üµ —Å–æ–ª“ì–∞</option>
            <option value="R">‚ü∂ –æ“£“ì–∞</option>
            <option value="U">‚ü∞ –∂–æ“ì–∞—Ä—ã</option>
            <option value="D">‚ü± —Ç”©–º–µ–Ω</option>
          </select>
        </label>

        <label>T –Ω“Ø–∫—Ç–µ—Å—ñ–Ω–¥–µ —Ç—ñ–ª –±–∞“ì—ã—Ç—ã:
          <select id="ct">
            <option value="">–¢–∞“£–¥–∞‚Ä¶</option>
            <option value="L">‚üµ —Å–æ–ª“ì–∞</option>
            <option value="R">‚ü∂ –æ“£“ì–∞</option>
            <option value="U">‚ü∞ –∂–æ“ì–∞—Ä—ã</option>
            <option value="D">‚ü± —Ç”©–º–µ–Ω</option>
          </select>
        </label>

        <div class="row">
          <span class="pill">–ö–æ–º–ø–∞—Å—Ç—ã –æ—Ä–Ω–∞–ª–∞—Å—Ç—ã—Ä—É: <b id="compassScore">0</b>/2</span>
          <button class="btn primary" id="btnCompass">–¢–µ–∫—Å–µ—Ä—É</button>
        </div>
      </div>

      <div class="hr"></div>

      <h2>3) “ö–ú–ñ —Ç–∞–ø—Å—ã—Ä–º–∞—Å—ã: –ö“Ø—à —Å—ã–∑—ã“õ—Ç–∞—Ä—ã (“õ–∞–π—Å—ã—Å—ã –¥“±—Ä—ã—Å?)</h2>
      <p class="muted">–î“±—Ä—ã—Å —Å—É—Ä–µ—Ç—Ç—ñ —Ç–∞“£–¥–∞.</p>
      <img src="durus.jpg" alt="“ö–ú–ñ: –∫“Ø—à —Å—ã–∑—ã“õ—Ç–∞—Ä—ã –¥“±—Ä—ã—Å —Å—É—Ä–µ—Ç" class="task-img">

      <div class="q">
        <label><input type="radio" name="lines" value="a"> a</label>
        <label><input type="radio" name="lines" value="”ô"> ”ô</label>
        <label><input type="radio" name="lines" value="–±"> –±</label>
        <label><input type="radio" name="lines" value="–≤"> –≤</label>
        <div class="row">
          <span class="pill">–ö“Ø—à —Å—ã–∑—ã“õ—Ç–∞—Ä—ã: <b id="linesScore">0</b>/2</span>
          <button class="btn primary" id="btnLines">–¢–µ–∫—Å–µ—Ä—É</button>
        </div>
        <p class="small">–ï—Å–∫–µ—Ä—Ç—É: —Å–µ–Ω –∞–π—Ç“õ–∞–Ω–¥–∞–π, –¥“±—Ä—ã—Å –∂–∞—É–∞–ø ‚Äî <b>–±</b>.</p>
      </div>

      <div class="hr"></div>

      <h2>4) “ö–ú–ñ —Ç–∞–ø—Å—ã—Ä–º–∞—Å—ã: –ú–∞–≥–Ω–∏—Ç—Ç—ñ“£ –ø–æ–ª—é—Å—Ç–µ—Ä—ñ–Ω –∞–Ω—ã“õ—Ç–∞</h2>
      <p class="muted">–°—É—Ä–µ—Ç–∫–µ “õ–∞—Ä–∞–ø, ”ô—Ä –∂–æ–ª–¥–∞“ì—ã –º–∞–≥–Ω–∏—Ç—Ç–µ—Ä–¥—ñ“£ —Å–æ–ª/–æ“£ “±—à—ã–Ω N –Ω–µ–º–µ—Å–µ S –¥–µ–ø –±–µ–ª–≥—ñ–ª–µ.</p>
      <img src="polus.jpg" alt="“ö–ú–ñ: –ø–æ–ª—é—Å—Ç–µ—Ä–¥—ñ –∞–Ω—ã“õ—Ç–∞—É" class="task-img">

      <div class="q">
        <p class="small"><b>–ñ–æ–ª 1</b> (—Å–æ–ª –º–∞–≥–Ω–∏—Ç—Ç—ñ“£ –æ“£ “±—à—ã N –±–µ—Ä—ñ–ª–≥–µ–Ω): –æ“£ –∂–∞“õ –º–∞–≥–Ω–∏—Ç—Ç—ñ“£ —Å–æ–ª/–æ“£ “±—à—ã–Ω —Ç–∞“£–¥–∞</p>
        <div class="row">
          <label style="min-width:220px">–û“£ –º–∞–≥–Ω–∏—Ç (—Å–æ–ª “±—à—ã):
            <select id="p1L"><option value="">–¢–∞“£–¥–∞‚Ä¶</option><option>N</option><option>S</option></select>
          </label>
          <label style="min-width:220px">–û“£ –º–∞–≥–Ω–∏—Ç (–æ“£ “±—à—ã):
            <select id="p1R"><option value="">–¢–∞“£–¥–∞‚Ä¶</option><option>N</option><option>S</option></select>
          </label>
        </div>

        <div class="hr"></div>

        <p class="small"><b>–ñ–æ–ª 2</b> (–æ“£ –º–∞–≥–Ω–∏—Ç—Ç—ñ“£ –æ“£ “±—à—ã S –±–µ—Ä—ñ–ª–≥–µ–Ω): —Å–æ–ª –º–∞–≥–Ω–∏—Ç—Ç—ñ“£ —Å–æ–ª/–æ“£ “±—à—ã–Ω —Ç–∞“£–¥–∞</p>
        <div class="row">
          <label style="min-width:220px">–°–æ–ª –º–∞–≥–Ω–∏—Ç (—Å–æ–ª “±—à—ã):
            <select id="p2L"><option value="">–¢–∞“£–¥–∞‚Ä¶</option><option>N</option><option>S</option></select>
          </label>
          <label style="min-width:220px">–°–æ–ª –º–∞–≥–Ω–∏—Ç (–æ“£ “±—à—ã):
            <select id="p2R"><option value="">–¢–∞“£–¥–∞‚Ä¶</option><option>N</option><option>S</option></select>
          </label>
        </div>

        <div class="hr"></div>

        <p class="small"><b>–ñ–æ–ª 3</b> (–æ“£ –º–∞–≥–Ω–∏—Ç—Ç—ñ“£ –æ“£ “±—à—ã S –±–µ—Ä—ñ–ª–≥–µ–Ω): —Å–æ–ª –º–∞–≥–Ω–∏—Ç—Ç—ñ“£ —Å–æ–ª/–æ“£ “±—à—ã–Ω —Ç–∞“£–¥–∞</p>
        <div class="row">
          <label style="min-width:220px">–°–æ–ª –º–∞–≥–Ω–∏—Ç (—Å–æ–ª “±—à—ã):
            <select id="p3L"><option value="">–¢–∞“£–¥–∞‚Ä¶</option><option>N</option><option>S</option></select>
          </label>
          <label style="min-width:220px">–°–æ–ª –º–∞–≥–Ω–∏—Ç (–æ“£ “±—à—ã):
            <select id="p3R"><option value="">–¢–∞“£–¥–∞‚Ä¶</option><option>N</option><option>S</option></select>
          </label>
        </div>

        <div class="hr"></div>

        <p class="small"><b>–ñ–æ–ª 4</b> (—Å–æ–ª –º–∞–≥–Ω–∏—Ç—Ç—ñ“£ –æ“£ “±—à—ã S –±–µ—Ä—ñ–ª–≥–µ–Ω): –æ“£ –º–∞–≥–Ω–∏—Ç—Ç—ñ“£ —Å–æ–ª/–æ“£ “±—à—ã–Ω —Ç–∞“£–¥–∞</p>
        <div class="row">
          <label style="min-width:220px">–û“£ –º–∞–≥–Ω–∏—Ç (—Å–æ–ª “±—à—ã):
            <select id="p4L"><option value="">–¢–∞“£–¥–∞‚Ä¶</option><option>N</option><option>S</option></select>
          </label>
          <label style="min-width:220px">–û“£ –º–∞–≥–Ω–∏—Ç (–æ“£ “±—à—ã):
            <select id="p4R"><option value="">–¢–∞“£–¥–∞‚Ä¶</option><option>N</option><option>S</option></select>
          </label>
        </div>

        <div class="row" style="margin-top:10px;">
          <span class="pill">–ü–æ–ª—é—Å—Ç–µ—Ä: <b id="polesScore">0</b>/2</span>
          <button class="btn primary" id="btnPoles">–¢–µ–∫—Å–µ—Ä—É</button>
          <button class="btn" id="btnPolesHint">–ñ–∞—É–∞–±—ã–Ω –∫”©—Ä—Å–µ—Ç—É</button>
        </div>

        <p class="small" id="polesHint" style="display:none;">
          –î“±—Ä—ã—Å –∂–∞—É–∞–ø—Ç–∞—Ä: 1) S/N, 2) S/N, 3) N/S, 4) S/N (—Å–æ–ª/–æ“£ —Ä–µ—Ç—ñ–º–µ–Ω –∫”©—Ä—Å–µ—Ç—ñ–ª–≥–µ–Ω –∂–µ—Ä–¥–µ).
        </p>
      </div>

      <div class="hr"></div>

      <h2>–ú–∏–Ω–∏ —Å“±—Ä–∞“õ—Ç–∞—Ä (–∂–µ–∫–µ-–∂–µ–∫–µ –∫–∞—Ä—Ç–æ—á–∫–∞)</h2>
      <p class="muted">–û“õ—É—à—ã ‚Äú–∂–∞–±—ã“õ –∂–∞—É–∞–ø—Ç—ã‚Äù ”©–∑—ñ –∞—à–∞–¥—ã ‚Äî “Ø–π—Ä–µ–Ω—É–≥–µ —ã“£“ì–∞–π–ª—ã.</p>

      <div class="cards" id="miniCards"></div>

      <div class="hr"></div>

      <h2>5) –ö—Ä–æ—Å—Å–≤–æ—Ä–¥ (–±–µ–∫—ñ—Ç—É —Ç–∞–ø—Å—ã—Ä–º–∞—Å—ã)</h2>
      <p class="muted">–¢–∞–ø—Å—ã—Ä–º–∞–ª–∞—Ä–¥—ã –æ—Ä—ã–Ω–¥–∞–ø –±–æ–ª“ì–∞–Ω —Å–æ“£, “±“ì—ã–º–¥–∞—Ä–¥—ã –∫—Ä–æ—Å—Å–≤–æ—Ä–¥–ø–µ–Ω –±–µ–∫—ñ—Ç.</p>

      <div class="cw-wrap">
        <div id="cwGrid" class="cw-grid"></div>

        <div class="cw-clues">
          <div class="cw-box">
            <h3>‚Üí –ö”©–ª–¥–µ–Ω–µ“£</h3>
            <div id="cwAcross"></div>
          </div>
          <div class="cw-box">
            <h3>‚Üì –¢—ñ–∫</h3>
            <div id="cwDown"></div>
          </div>
        </div>

        <div class="row">
          <button class="btn primary" id="btnCwCheck">–¢–µ–∫—Å–µ—Ä—É</button>
          <button class="btn" id="btnCwReveal">–ñ–∞—É–∞–±—ã–Ω –∫”©—Ä—Å–µ—Ç—É</button>
          <button class="btn ghost" id="btnCwClear">–¢–∞–∑–∞–ª–∞—É</button>
          <span class="pill">–ö—Ä–æ—Å—Å–≤–æ—Ä–¥: <b id="cwScore">0</b>/1</span>
        </div>
        <div class="small" id="cwMsg"></div>
      </div>
    </section>

    <!-- RIGHT -->
    <aside class="card">
      <h2>–ñ—ã–ª–¥–∞–º –∫–µ—Ä—ñ –±–∞–π–ª–∞–Ω—ã—Å</h2>
      <p class="muted">–û“õ—É—à—ã —Ç–∞“£–¥–∞—Å–∞ ‚Äî –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∫–µ“£–µ—Å –±–µ—Ä–µ–¥—ñ.</p>

      <label>Traffic light (”©–∑—ñ–Ω-”©–∑—ñ –±–∞“ì–∞–ª–∞—É):</label>
      <select id="traffic">
        <option value="">–¢–∞“£–¥–∞‚Ä¶</option>
        <option value="green">üü¢ –¢“Ø—Å—ñ–Ω–¥—ñ–º</option>
        <option value="yellow">üü° –ñ–∞—Ç—Ç—ã“ì—É –∫–µ—Ä–µ–∫</option>
        <option value="red">üî¥ “ö–∏–Ω–∞–ª–¥—ã–º</option>
      </select>
      <p class="muted" id="trafficAdvice" style="margin-top:10px;"></p>

      <div class="hr"></div>

      <h2>–ù”ô—Ç–∏–∂–µ–Ω—ñ –∫”©—à—ñ—Ä—É</h2>
      <button class="btn" id="btnExport">–ù”ô—Ç–∏–∂–µ–Ω—ñ –∫”©—à—ñ—Ä—É</button>
      <pre class="small" id="exportText" style="white-space:pre-wrap;margin-top:10px;"></pre>

      <div class="hr"></div>

      <h2>2-–±–µ—Ç–∫–µ ”©—Ç—É</h2>
      <p class="muted">–†–µ—Ñ–ª–µ–∫—Å–∏—è–Ω—ã –±”©–ª–µ–∫ –±–µ—Ç–∫–µ —à—ã“ì–∞—Ä–¥—ã“õ ‚Äî –º“±“ì–∞–ª—ñ–º–≥–µ –¥–µ, –æ“õ—É—à—ã“ì–∞ –¥–∞ —ã“£“ì–∞–π–ª—ã.</p>
      <a class="navlink" href="reflection.html">–†–µ—Ñ–ª–µ–∫—Å–∏—è –±–µ—Ç—ñ ‚Üí</a>

      <div class="hr"></div>
      <p class="small">–ë–∞—Ä–ª—ã“ì—ã –±—Ä–∞—É–∑–µ—Ä–¥–µ —Å–∞“õ—Ç–∞–ª–∞–¥—ã (localStorage). –ò–Ω—Ç–µ—Ä–Ω–µ—Ç—Å—ñ–∑ –¥–µ –∂“±–º—ã—Å —ñ—Å—Ç–µ–π–¥—ñ.</p>
    </aside>

  </div>
</main>

<script>
  // ====== State ======
  const state = {
    test: 0,     // /3
    compass: 0,  // /2
    lines: 0,    // /2
    poles: 0,    // /2
    crossword: 0 // /1
  };

  const $ = (id)=>document.getElementById(id);

  function setLevel(total){
    const t = $("levelText");
    if(total >= 9) t.textContent = "–î–µ“£–≥–µ–π: –ñ–æ“ì–∞—Ä—ã (”©—Ç–µ –∂–∞“õ—Å—ã)";
    else if(total >= 6) t.textContent = "–î–µ“£–≥–µ–π: –û—Ä—Ç–∞ (–∂–∞“õ—Å—ã)";
    else t.textContent = "–î–µ“£–≥–µ–π: –ë–∞—Å—Ç–∞–ø“õ—ã (“õ–∞–π—Ç–∞ “õ–∞—Ä–∞—É –∫–µ—Ä–µ–∫)";
  }

  function computeTotal(){
    const total = state.test + state.compass + state.lines + state.poles + state.crossword;
    $("total").textContent = total;
    setLevel(total);
    save();
  }

  function save(){
    localStorage.setItem("magnet_qmj_v1", JSON.stringify({
      state,
      traffic: $("traffic").value
    }));
  }
  function load(){
    const raw = localStorage.getItem("magnet_qmj_v1");
    if(!raw) return;
    try{
      const d = JSON.parse(raw);
      if(d?.state){
        Object.assign(state, d.state);
        $("testScore").textContent = state.test;
        $("compassScore").textContent = state.compass;
        $("linesScore").textContent = state.lines;
        $("polesScore").textContent = state.poles;
        $("cwScore").textContent = state.crossword;
      }
      if(d?.traffic) $("traffic").value = d.traffic;
    }catch(e){}
    computeTotal();
    updateTrafficAdvice();
  }

  // ====== 1) Mini test ======
  const KEY_TEST = {t1:"b", t2:"b", t3:"b"};
  $("btnTest").addEventListener("click", ()=>{
    let sc=0;
    for(const k of ["t1","t2","t3"]){
      const v = document.querySelector(`input[name="${k}"]:checked`)?.value;
      if(v && v===KEY_TEST[k]) sc+=1;
    }
    state.test=sc;
    $("testScore").textContent=sc;
    computeTotal();
  });

  // ====== 2) Compass task ======
  // Simple model: outside field N->S: above/right direction mostly right; left of N points left; right of S points left; bottom middle points right.
  // Answers: X = L, Y = R, Z = R, T = L
  const COMPASS_KEY = {cx:"L", cy:"R", cz:"R", ct:"L"};
  $("btnCompass").addEventListener("click", ()=>{
    const ok = ($("cx").value===COMPASS_KEY.cx) &&
               ($("cy").value===COMPASS_KEY.cy) &&
               ($("cz").value===COMPASS_KEY.cz) &&
               ($("ct").value===COMPASS_KEY.ct);
    state.compass = ok ? 2 : 0;
    $("compassScore").textContent = state.compass;
    computeTotal();
  });

  // ====== 3) Field lines ======
  // user confirmed correct is "–±"
  $("btnLines").addEventListener("click", ()=>{
    const v = document.querySelector(`input[name="lines"]:checked`)?.value;
    state.lines = (v==="–±") ? 2 : 0;
    $("linesScore").textContent = state.lines;
    computeTotal();
  });

  // ====== 4) Poles task ======
  // Derived answers from image logic:
  // Row1 (right magnet): left=S, right=N
  // Row2 (left magnet): left=S, right=N
  // Row3 (left magnet): left=N, right=S
  // Row4 (right magnet): left=S, right=N
  const POLES_KEY = {
    p1L:"S", p1R:"N",
    p2L:"S", p2R:"N",
    p3L:"N", p3R:"S",
    p4L:"S", p4R:"N",
  };

  $("btnPoles").addEventListener("click", ()=>{
    let ok=true;
    for(const id in POLES_KEY){
      if($(id).value !== POLES_KEY[id]) { ok=false; break; }
    }
    state.poles = ok ? 2 : 0;
    $("polesScore").textContent = state.poles;
    computeTotal();
  });

  $("btnPolesHint").addEventListener("click", ()=>{
    const p = $("polesHint");
    p.style.display = (p.style.display==="none") ? "block" : "none";
  });

  // ====== Mini question cards (from your image) ======
  const MINI = [
    {q:"–ú–∞–≥–Ω–∏—Ç ”©—Ä—ñ—Å—ñ–Ω—ñ“£ –∫“Ø—à —Å—ã–∑—ã“õ—Ç–∞—Ä—ã ‚Ä¶ ?", a:"–ö“Ø—à —Å—ã–∑—ã“õ—Ç–∞—Ä—ã —Å—ã—Ä—Ç“õ—ã –∫–µ“£—ñ—Å—Ç—ñ–∫—Ç–µ N ‚Üí S –±–∞“ì—ã—Ç—Ç–∞–ª–∞–¥—ã."},
    {q:"–°–æ–ª—Ç“Ø—Å—Ç—ñ–∫ –ø–æ–ª—é—Å—Ç—ñ“£ —à–∞—Ä—Ç—Ç—ã –±–µ–ª–≥—ñ—Å—ñ?", a:"N"},
    {q:"–ê—Ç—Ç–∞—Å –ø–æ–ª—é—Å—Ç–µ—Ä ‚Ä¶ ; ”ô—Ä –∞—Ç—Ç–∞—Å –ø–æ–ª—é—Å—Ç–µ—Ä ‚Ä¶", a:"–ê—Ç—Ç–∞—Å –ø–æ–ª—é—Å—Ç–µ—Ä —Ç–µ–±—ñ–ª–µ–¥—ñ, ”ô—Ä –∞—Ç—Ç–∞—Å –ø–æ–ª—é—Å—Ç–µ—Ä —Ç–∞—Ä—Ç—ã–ª–∞–¥—ã."},
    {q:"–ú–∞–≥–Ω–∏—Ç—Ç—ñ“£ –Ω–µ—à–µ –ø–æ–ª—é—Å—ñ –±–∞—Ä?", a:"–ï–∫—ñ (N –∂”ô–Ω–µ S)."},
    {q:"–ê—Ç–∞-–±–∞–±–∞–ª–∞—Ä—ã–º—ã–∑ –∞–ª—ã—Å —Å–∞–ø–∞—Ä–¥–∞ –∂–æ–ª–¥—ã “õ–∞–ª–∞–π —Ç–∞–ø“õ–∞–Ω?", a:"–ö–æ–º–ø–∞—Å (–±–∞“ì–¥–∞—Ä–ª–∞—É “õ“±—Ä–∞–ª—ã) –∞—Ä“õ—ã–ª—ã."},
    {q:"–ñ–µ—Ä–¥—ñ“£ –≥–µ–æ–≥—Ä–∞—Ñ–∏—è–ª—ã“õ –∂”ô–Ω–µ –º–∞–≥–Ω–∏—Ç—Ç—ñ–∫ –ø–æ–ª—é—Å—Ç–µ—Ä—ñ ‚Ä¶", a:"–î”ô–ª —Å”ô–π–∫–µ—Å –∫–µ–ª–º–µ–π–¥—ñ (–æ—Ä—ã–Ω–¥–∞—Ä—ã –∞–∑–¥–∞–ø —ã“ì—ã—Å“õ–∞–Ω)."},
    {q:"–û“£—Ç“Ø—Å—Ç—ñ–∫ –ø–æ–ª—é—Å—Ç—ñ“£ —à–∞—Ä—Ç—Ç—ã –±–µ–ª–≥—ñ—Å—ñ?", a:"S"},
    {q:"–ï“£ –∫”©–ø –º–∞–≥–Ω–∏—Ç—Ç—ñ–∫ —Ç–∞—Ä—Ç—ã–ª—É –∫“Ø—à—ñ –±–æ–ª–∞—Ç—ã–Ω –∂–µ—Ä?", a:"–ü–æ–ª—é—Å—Ç–µ—Ä –º–∞“£—ã–Ω–¥–∞."},
    {q:"–ú–∞–≥–Ω–∏—Ç —Å—ã–∑—ã“õ—Ç–∞—Ä—ã “õ–∞–ª–∞–π –±–∞“ì—ã—Ç—Ç–∞–ª“ì–∞–Ω?", a:"–°—ã—Ä—Ç“õ—ã –∫–µ“£—ñ—Å—Ç—ñ–∫—Ç–µ N-–Ω–µ–Ω S-–∫–µ “õ–∞—Ä–∞–π."},
  ];

  const miniBox = $("miniCards");
  MINI.forEach((it,idx)=>{
    const div = document.createElement("div");
    div.className="flash";
    div.innerHTML = `
      <b>${idx+1}) ${it.q}</b>
      <button class="miniBtn" type="button">–ñ–∞—É–∞–±—ã–Ω –∞—à—É</button>
      <div class="ans"><b>–ñ–∞—É–∞–ø:</b> ${it.a}</div>
    `;
    div.querySelector(".miniBtn").addEventListener("click", ()=>{
      div.classList.toggle("show");
    });
    miniBox.appendChild(div);
  });

  // ====== Crossword (same content, adapted) ======
  const WORDS = [
    {id:1, dir:'across', row:0, col:0, answer:'–ú–ê–ì–ù–ò–¢', clue:'–¢–µ–º—ñ—Ä–¥—ñ —Ç–∞—Ä—Ç–∞—Ç—ã–Ω —Ç–∞–±–∏“ì–∏/–∂–∞—Å–∞–Ω–¥—ã –∑–∞—Ç'},
    {id:4, dir:'across', row:2, col:1, answer:'–ü–û–õ–Æ–°', clue:'–ú–∞–≥–Ω–∏—Ç—Ç—ñ“£ –µ“£ –∫“Ø—à—Ç—ñ –±”©–ª—ñ–≥—ñ (N –∂”ô–Ω–µ S)'},
    {id:6, dir:'across', row:4, col:0, answer:'–¢–ê–†–¢–£', clue:'“ö–∞—Ä–∞–º–∞-“õ–∞—Ä—Å—ã –ø–æ–ª—é—Å—Ç–µ—Ä ”ô—Å–µ—Ä—ñ'},
    {id:7, dir:'across', row:6, col:2, answer:'”®–†–Ü–°', clue:'–ö“Ø—à ”ô—Å–µ—Ä –µ—Ç–µ—Ç—ñ–Ω –∫–µ“£—ñ—Å—Ç—ñ–∫'},
    {id:9, dir:'across', row:8, col:0, answer:'–ö–û–ú–ü–ê–°', clue:'–ë–∞“ì–¥–∞—Ä–ª–∞—É “õ“±—Ä–∞–ª—ã'},
    {id:11, dir:'across', row:10, col:1, answer:'–¢–ï–ú–Ü–†', clue:'–ú–∞–≥–Ω–∏—Ç —Ç–∞—Ä—Ç–∞—Ç—ã–Ω –Ω–µ–≥—ñ–∑–≥—ñ –º–µ—Ç–∞–ª–ª'},
    {id:2, dir:'down', row:0, col:3, answer:'–ú–ê–ì–ù–ò–¢–¢–Ü–ö', clue:'‚Ä¶ ”©—Ä—ñ—Å ‚Äî –º–∞–≥–Ω–∏—Ç —Ç—É–¥—ã—Ä–∞—Ç—ã–Ω –∫“Ø—à –∫–µ“£—ñ—Å—Ç—ñ–≥—ñ'},
    {id:3, dir:'down', row:0, col:5, answer:'–ù–ò–ö–ï–õ–¨', clue:'–ú–∞–≥–Ω–∏—Ç —Ç–∞—Ä—Ç–∞ –∞–ª–∞—Ç—ã–Ω –º–µ—Ç–∞–ª–ª (Ni)'},
    {id:5, dir:'down', row:2, col:7, answer:'–ò–¢–ï–†–£', clue:'–ë—ñ—Ä–¥–µ–π –ø–æ–ª—é—Å—Ç–µ—Ä ”ô—Å–µ—Ä—ñ'},
    {id:8, dir:'down', row:4, col:9, answer:'–§–ï–†–†–û', clue:'‚Ä¶ –º–∞–≥–Ω–µ—Ç–∏–∑–º ‚Äî —Ç–µ–º—ñ—Ä —Ç–µ–∫—Ç–µ—Å “õ–∞—Å–∏–µ—Ç'},
    {id:10, dir:'down', row:6, col:5, answer:'–ë–û–õ–ê–¢', clue:'–¢“±—Ä–∞“õ—Ç—ã –º–∞–≥–Ω–∏—Ç –∂–∞—Å–∞–ª–∞—Ç—ã–Ω –º–∞—Ç–µ—Ä–∏–∞–ª'},
  ];

  const ROWS = 13, COLS = 12;
  const grid = Array.from({length: ROWS}, ()=>Array(COLS).fill(null));

  WORDS.forEach(w=>{
    for(let i=0;i<w.answer.length;i++){
      const r = (w.dir==='across') ? w.row : w.row + i;
      const c = (w.dir==='across') ? w.col + i : w.col;
      grid[r][c] = {letter:w.answer[i], num:null};
    }
  });
  WORDS.forEach(w=>{
    if(grid[w.row][w.col]) grid[w.row][w.col].num = w.id;
  });

  // bounds
  let minR=ROWS, maxR=0, minC=COLS, maxC=0;
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      if(grid[r][c]){
        minR=Math.min(minR,r); maxR=Math.max(maxR,r);
        minC=Math.min(minC,c); maxC=Math.max(maxC,c);
      }
    }
  }
  const visRows = maxR-minR+1, visCols=maxC-minC+1;

  const cwGrid = $("cwGrid");
  cwGrid.style.gridTemplateColumns = `repeat(${visCols}, 36px)`;
  cwGrid.style.gridTemplateRows = `repeat(${visRows}, 36px)`;

  const inputMap = {};
  for(let r=minR;r<=maxR;r++){
    for(let c=minC;c<=maxC;c++){
      const cell = document.createElement("div");
      cell.className="cw-cell";
      const key = `${r},${c}`;

      if(grid[r][c]){
        cell.classList.add("active");
        cell.dataset.row=r; cell.dataset.col=c;

        if(grid[r][c].num){
          const num = document.createElement("span");
          num.className="num";
          num.textContent = grid[r][c].num;
          cell.appendChild(num);
        }

        const inp = document.createElement("input");
        inp.maxLength=1; inp.autocomplete="off"; inp.spellcheck=false;
        inp.addEventListener("input", ()=>{
          const v = inp.value.toUpperCase().replace(/[^–ê-–Ø“í“ö“¢”®“∞“Æ–ÜA-Z]/g,'');
          inp.value = v ? v[v.length-1] : '';
        });
        cell.appendChild(inp);
        inputMap[key]=inp;
      }

      cwGrid.appendChild(cell);
    }
  }

  // clues
  const cwAcross = $("cwAcross");
  const cwDown = $("cwDown");
  function addClue(w, box){
    const div = document.createElement("div");
    div.className="cw-item";
    div.textContent = `${w.id}. ${w.clue}`;
    div.addEventListener("click", ()=>{
      const inp = inputMap[`${w.row},${w.col}`];
      inp?.focus();
    });
    box.appendChild(div);
  }
  WORDS.filter(w=>w.dir==="across").forEach(w=>addClue(w, cwAcross));
  WORDS.filter(w=>w.dir==="down").forEach(w=>addClue(w, cwDown));

  function getCellEl(r,c){
    return cwGrid.querySelector(`.cw-cell[data-row="${r}"][data-col="${c}"]`);
  }

  function cwCheck(){
    let total=0, correct=0;
    WORDS.forEach(w=>{
      for(let i=0;i<w.answer.length;i++){
        const r = (w.dir==='across')? w.row : w.row+i;
        const c = (w.dir==='across')? w.col+i : w.col;
        const inp = inputMap[`${r},${c}`];
        const cell = getCellEl(r,c);
        if(!inp) return;
        total++;
        const ok = inp.value.toUpperCase() === w.answer[i];
        if(ok){ correct++; cell?.classList.add("correct"); cell?.classList.remove("wrong"); }
        else if(inp.value){ cell?.classList.add("wrong"); cell?.classList.remove("correct"); }
        else { cell?.classList.remove("wrong","correct"); }
      }
    });
    const msg = $("cwMsg");
    if(correct===total){
      msg.textContent="‚úì –ö—Ä–æ—Å—Å–≤–æ—Ä–¥ —Ç–æ–ª—ã“õ –¥“±—Ä—ã—Å!";
      state.crossword=1;
    }else{
      msg.textContent=`${correct} / ${total} –¥“±—Ä—ã—Å`;
      state.crossword=0;
    }
    $("cwScore").textContent = state.crossword;
    computeTotal();
  }

  function cwReveal(){
    WORDS.forEach(w=>{
      for(let i=0;i<w.answer.length;i++){
        const r = (w.dir==='across')? w.row : w.row+i;
        const c = (w.dir==='across')? w.col+i : w.col;
        const inp = inputMap[`${r},${c}`];
        const cell = getCellEl(r,c);
        if(inp){ inp.value = w.answer[i]; cell?.classList.add("correct"); cell?.classList.remove("wrong"); }
      }
    });
    $("cwMsg").textContent="–ñ–∞—É–∞–ø—Ç–∞—Ä –∫”©—Ä—Å–µ—Ç—ñ–ª–¥—ñ";
    state.crossword=1;
    $("cwScore").textContent=1;
    computeTotal();
  }

  function cwClear(){
    Object.values(inputMap).forEach(i=>i.value="");
    cwGrid.querySelectorAll(".cw-cell").forEach(c=>c.classList.remove("correct","wrong"));
    $("cwMsg").textContent="";
    state.crossword=0;
    $("cwScore").textContent=0;
    computeTotal();
  }

  $("btnCwCheck").addEventListener("click", cwCheck);
  $("btnCwReveal").addEventListener("click", cwReveal);
  $("btnCwClear").addEventListener("click", cwClear);

  // ====== Traffic light ======
  function updateTrafficAdvice(){
    const v = $("traffic").value;
    let t="";
    if(v==="green") t="üü¢ –ö–µ—Ä–µ–º–µ—Ç! –ï–Ω–¥—ñ 1 –º—ã—Å–∞–ª –∫–µ–ª—Ç—ñ—Ä: –∫“Ø—à —Å—ã–∑—ã“õ—Ç–∞—Ä—ã –Ω–µ–≥–µ N‚ÜíS –±–∞“ì—ã—Ç—Ç–∞–ª–∞–¥—ã?";
    if(v==="yellow") t="üü° –ñ–∞—Ç—Ç—ã“ì—É: –∞—Ç—Ç–∞—Å/”ô—Ä –∞—Ç—Ç–∞—Å –ø–æ–ª—é—Å—Ç–µ—Ä–¥—ñ 5 –º—ã—Å–∞–ª–º–µ–Ω –±–µ–∫—ñ—Ç.";
    if(v==="red") t="üî¥ “ö–∞–¥–∞–º: 1) N/S –∞–Ω—ã“õ—Ç–∞; 2) N‚ÜíS –±–∞“ì—ã—Ç—ã–Ω –∂–∞—Ç—Ç–∞; 3) “õ–∞–π—Ç–∞ —Ç–µ—Å—Ç.";
    $("trafficAdvice").textContent=t;
    save();
  }
  $("traffic").addEventListener("change", updateTrafficAdvice);

  // ====== Export ======
  $("btnExport").addEventListener("click", ()=>{
    const total = state.test+state.compass+state.lines+state.poles+state.crossword;
    const traffic = $("traffic").value || "—Ç–∞“£–¥–∞–ª–º–∞–¥—ã";
    const text =
`–¢–∞“õ—ã—Ä—ã–ø: –¢“±—Ä–∞“õ—Ç—ã –º–∞–≥–Ω–∏—Ç—Ç–µ—Ä (“ö–ú–ñ)
–ù”ô—Ç–∏–∂–µ: ${total}/10
- –ú–∏–Ω–∏-—Ç–µ—Å—Ç: ${state.test}/3
- –ö–æ–º–ø–∞—Å (X,Y,Z,T): ${state.compass}/2
- –ö“Ø—à —Å—ã–∑—ã“õ—Ç–∞—Ä—ã: ${state.lines}/2
- –ü–æ–ª—é—Å—Ç–µ—Ä: ${state.poles}/2
- –ö—Ä–æ—Å—Å–≤–æ—Ä–¥: ${state.crossword}/1
Traffic light: ${traffic}
–ö–µ“£–µ—Å: ${$("trafficAdvice").textContent || "‚Äî"}`;
    $("exportText").textContent=text;
    navigator.clipboard?.writeText(text).catch(()=>{});
  });

  // ====== Total buttons ======
  $("btnCalc").addEventListener("click", computeTotal);

  $("btnReset").addEventListener("click", ()=>{
    // clear radios
    document.querySelectorAll('input[type="radio"]').forEach(r=>r.checked=false);
    // selects
    ["cx","cy","cz","ct","p1L","p1R","p2L","p2R","p3L","p3R","p4L","p4R","traffic"].forEach(id=>$(id).value="");
    // scores
    state.test=0; state.compass=0; state.lines=0; state.poles=0; state.crossword=0;
    $("testScore").textContent="0";
    $("compassScore").textContent="0";
    $("linesScore").textContent="0";
    $("polesScore").textContent="0";
    $("cwScore").textContent="0";
    $("trafficAdvice").textContent="";
    $("exportText").textContent="";
    $("polesHint").style.display="none";
    cwClear();
    localStorage.removeItem("magnet_qmj_v1");
    computeTotal();
  });

  // INIT
  load();
  computeTotal();
  updateTrafficAdvice();
</script>
</body>
</html>
