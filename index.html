<!doctype html>
<html lang="kk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–¢“±—Ä–∞“õ—Ç—ã –º–∞–≥–Ω–∏—Ç—Ç–µ—Ä ‚Äî “ö–ë –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Å—ã</title>
  <style>
    :root{--bg:#0b1220;--card:#121a2b;--text:#eaf0ff;--muted:#a9b4d6;--ok:#2dd4bf;--warn:#fbbf24;--bad:#fb7185;}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#0b1220,#070b14);color:var(--text)}
    header{padding:22px 16px;border-bottom:1px solid rgba(255,255,255,.08);position:sticky;top:0;background:rgba(11,18,32,.85);backdrop-filter:blur(10px);z-index:5}
    header h1{margin:0;font-size:18px}
    header p{margin:6px 0 0;color:var(--muted);font-size:13px}
    main{max-width:980px;margin:0 auto;padding:16px;display:grid;gap:14px}
    .grid{display:grid;grid-template-columns:1fr;gap:14px}
    @media (min-width:900px){.grid{grid-template-columns:1.2fr .8fr}}
    .card{background:rgba(18,26,43,.92);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:14px 14px 12px}
    .card h2{margin:0 0 10px;font-size:15px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pill{display:inline-flex;gap:6px;align-items:center;padding:6px 10px;border:1px solid rgba(255,255,255,.12);border-radius:999px;color:var(--muted);font-size:12px}
    .btn{cursor:pointer;border:0;border-radius:12px;padding:10px 12px;background:#1b2742;color:var(--text);font-weight:600}
    .btn:hover{filter:brightness(1.08)}
    .btn.primary{background:linear-gradient(90deg,#2563eb,#22c55e)}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,.12)}
    .muted{color:var(--muted);font-size:13px}
    .q{padding:10px;border:1px solid rgba(255,255,255,.10);border-radius:14px;margin:10px 0;background:rgba(0,0,0,.12)}
    label{display:block;margin:6px 0;font-size:13px}
    input[type="text"], textarea, select{
      width:100%;padding:10px 10px;border-radius:12px;border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.18);color:var(--text);outline:none
    }
    textarea{min-height:90px;resize:vertical}
    .score{font-size:26px;font-weight:800}
    .tag{display:inline-flex;align-items:center;padding:5px 10px;border-radius:999px;font-size:12px;font-weight:700}
    .tag.ok{background:rgba(45,212,191,.15);color:var(--ok);border:1px solid rgba(45,212,191,.35)}
    .tag.warn{background:rgba(251,191,36,.13);color:var(--warn);border:1px solid rgba(251,191,36,.35)}
    .tag.bad{background:rgba(251,113,133,.12);color:var(--bad);border:1px solid rgba(251,113,133,.35)}
    .badge{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:14px;border:1px dashed rgba(255,255,255,.18);background:rgba(0,0,0,.10)}
    .badges{display:grid;gap:10px}
    .small{font-size:12px;color:var(--muted)}
    .hr{height:1px;background:rgba(255,255,255,.08);margin:12px 0}
    .hint{font-size:12px;color:var(--muted);margin-top:6px}
    .list{margin:6px 0 0;padding-left:18px;color:var(--muted);font-size:13px}
  </style>
</head>

<body>
<header>
  <h1>–¢“±—Ä–∞“õ—Ç—ã –º–∞–≥–Ω–∏—Ç—Ç–µ—Ä ‚Äî “ö–∞–ª—ã–ø—Ç–∞—Å—Ç—ã—Ä—É—à—ã –±–∞“ì–∞–ª–∞—É –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Å—ã</h1>
  <p>–ê–≤—Ç–æ-–±–∞“ì–∞–ª–∞—É + –∫–µ—Ä—ñ –±–∞–π–ª–∞–Ω—ã—Å + –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è (—Å—Ç–∞–Ω–¥–∞—Ä—Ç—Ç–∞–Ω —Ç—ã—Å —ç–ª–µ–º–µ–Ω—Ç) + —Ä–µ—Ñ–ª–µ–∫—Å–∏—è 3-2-1</p>
</header>

<main>
  <div class="grid">

    <!-- –õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê -->
    <section class="card">
      <h2>1) –ú–∏–Ω–∏-—Ç–µ—Å—Ç (–∞–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç–µ–∫—Å–µ—Ä—ñ–ª–µ–¥—ñ)</h2>
      <p class="muted">–ú–∞“õ—Å–∞—Ç: –Ω–µ–≥—ñ–∑–≥—ñ “±“ì—ã–º–¥–∞—Ä–¥—ã –∂—ã–ª–¥–∞–º —Ç–µ–∫—Å–µ—Ä—É (8.4.3.1‚Äì8.4.3.3).</p>

      <div class="q" data-q="1">
        <div><b>1.</b> –ö“Ø—à —Å—ã–∑—ã“õ—Ç–∞—Ä—ã —Å—ã—Ä—Ç“õ—ã –∫–µ“£—ñ—Å—Ç—ñ–∫—Ç–µ “õ–∞–π –±–∞“ì—ã—Ç—Ç–∞ –±–æ–ª–∞–¥—ã?</div>
        <label><input type="radio" name="q1" value="a"> S ‚Üí N</label>
        <label><input type="radio" name="q1" value="b"> N ‚Üí S</label>
        <label><input type="radio" name="q1" value="c"> –ñ–æ“õ, –±–∞“ì—ã—Ç—ã –±–æ–ª–º–∞–π–¥—ã</label>
        <label><input type="radio" name="q1" value="d"> –ö–µ–∑ –∫–µ–ª–≥–µ–Ω –±–∞“ì—ã—Ç—Ç–∞</label>
      </div>

      <div class="q" data-q="2">
        <div><b>2.</b> “∞“õ—Å–∞—Å –ø–æ–ª—é—Å—Ç–µ—Ä “õ–∞–ª–∞–π ”ô—Å–µ—Ä–ª–µ—Å–µ–¥—ñ?</div>
        <label><input type="radio" name="q2" value="a"> –¢–∞—Ä—Ç—ã–ª–∞–¥—ã</label>
        <label><input type="radio" name="q2" value="b"> –¢–µ–±—ñ–ª–µ–¥—ñ</label>
        <label><input type="radio" name="q2" value="c"> ”ò—Å–µ—Ä–ª–µ—Å–ø–µ–π–¥—ñ</label>
        <label><input type="radio" name="q2" value="d"> –¢–µ–∫ “õ—ã–∑–¥—ã—Ä—Å–∞ ”ô—Å–µ—Ä–ª–µ—Å–µ–¥—ñ</label>
      </div>

      <div class="q" data-q="3">
        <div><b>3.</b> –ö“Ø—à —Å—ã–∑—ã“õ—Ç–∞—Ä—ã–Ω—ã“£ ‚Äú—Ç—ã“ì—ã–∑‚Äù –æ—Ä–Ω–∞–ª–∞—Å—É—ã –Ω–µ–Ω—ñ –±—ñ–ª–¥—ñ—Ä–µ–¥—ñ?</div>
        <label><input type="radio" name="q3" value="a"> ”®—Ä—ñ—Å ”ô–ª—Å—ñ–∑</label>
        <label><input type="radio" name="q3" value="b"> ”®—Ä—ñ—Å –∫“Ø—à—Ç—ñ—Ä–µ–∫</label>
        <label><input type="radio" name="q3" value="c"> –ú–∞–≥–Ω–∏—Ç –∂–æ“õ</label>
        <label><input type="radio" name="q3" value="d"> –ë“±–ª —Ç–µ–∫ —Å—É—Ä–µ—Ç “Ø—à—ñ–Ω</label>
      </div>

      <div class="row">
        <button class="btn primary" id="btnCheck">–¢–µ–∫—Å–µ—Ä—É</button>
        <button class="btn ghost" id="btnReset">“ö–∞–π—Ç–∞ –±–∞—Å—Ç–∞—É</button>
        <span class="pill">–¢–µ—Å—Ç “±–ø–∞–π—ã: <b id="testScore">0</b>/30</span>
      </div>

      <div class="hr"></div>

      <h2>2) “ö–ë —Ç–∞–ø—Å—ã—Ä–º–∞—Å—ã: ‚Äú“ö–∞—Ç–µ “õ–∞–π–¥–∞?‚Äù</h2>
      <p class="muted">–¢”©–º–µ–Ω–¥–µ–≥—ñ 4 —Ç“±–∂—ã—Ä—ã–º–Ω—ã“£ “õ–∞–π—Å—ã—Å—ã “õ–∞—Ç–µ? “ö–∞—Ç–µ –±–æ–ª—Å–∞ ‚Äî –¥“±—Ä—ã—Å—ã–Ω –∂–∞–∑.</p>

      <div class="q">
        <label>–∞) ‚Äú–ú–∞–≥–Ω–∏—Ç—Ç—ñ “õ–∞“õ –±”©–ª—Å–µ, —Ç–µ–∫ N –ø–æ–ª—é—Å—ñ –±–∞—Ä –±”©–ª—ñ–∫ —à—ã“ì–∞–¥—ã.‚Äù (–¥“±—Ä—ã—Å—ã?)</label>
        <input type="text" id="fixA" placeholder="–ú—ã—Å–∞–ª—ã: ”ô—Ä –±”©–ª—ñ–∫ –∂–∞“£–∞ –º–∞–≥–Ω–∏—Ç –±–æ–ª–∞–¥—ã, –µ–∫–µ—É—ñ–Ω–¥–µ –¥–µ N –∂”ô–Ω–µ S –±–∞—Ä" />
        <label class="hint">–±) ‚Äú–°—ã—Ä—Ç“õ—ã –∫–µ“£—ñ—Å—Ç—ñ–∫—Ç–µ –∫“Ø—à —Å—ã–∑—ã“õ—Ç–∞—Ä—ã N‚ÜíS.‚Äù (“õ–∞—Ç–µ/–¥“±—Ä—ã—Å?)</label>
        <select id="fixB">
          <option value="">–¢–∞“£–¥–∞‚Ä¶</option>
          <option value="true">–î“±—Ä—ã—Å</option>
          <option value="false">“ö–∞—Ç–µ</option>
        </select>
        <label class="hint">–≤) ‚Äú“∞“õ—Å–∞—Å –ø–æ–ª—é—Å—Ç–µ—Ä —Ç–µ–±—ñ–ª–µ–¥—ñ.‚Äù (“õ–∞—Ç–µ/–¥“±—Ä—ã—Å?)</label>
        <select id="fixC">
          <option value="">–¢–∞“£–¥–∞‚Ä¶</option>
          <option value="true">–î“±—Ä—ã—Å</option>
          <option value="false">“ö–∞—Ç–µ</option>
        </select>
        <label class="hint">–≥) ‚Äú–ö“Ø—à —Å—ã–∑—ã“õ—Ç–∞—Ä—ã “õ–∏—ã–ª—ã—Å–∞ –∞–ª–∞–¥—ã.‚Äù (–¥“±—Ä—ã—Å—ã?)</label>
        <input type="text" id="fixD" placeholder="–ú—ã—Å–∞–ª—ã: –∫“Ø—à —Å—ã–∑—ã“õ—Ç–∞—Ä—ã “õ–∏—ã–ª—ã—Å–ø–∞–π–¥—ã" />
      </div>

      <div class="row">
        <button class="btn primary" id="btnCheckTask">–¢–∞–ø—Å—ã—Ä–º–∞–Ω—ã –±–∞“ì–∞–ª–∞—É</button>
        <span class="pill">–¢–∞–ø—Å—ã—Ä–º–∞ “±–ø–∞–π—ã: <b id="taskScore">0</b>/30</span>
      </div>

      <div class="hr"></div>

      <h2>3) –†–µ—Ñ–ª–µ–∫—Å–∏—è 3-2-1 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç—Ç–∞–Ω —Ç—ã—Å —ç–ª–µ–º–µ–Ω—Ç)</h2>
      <p class="muted">3 –Ω”ô—Ä—Å–µ –±—ñ–ª–¥—ñ–º / 2 “õ–∏—ã–Ω–¥—ã“õ / 1 —Å“±—Ä–∞“õ ‚Äî –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞“ì–∞ –∂—ñ–±–µ—Ä–µ —Å–∞–ª–∞—Å—ã“£.</p>
      <textarea id="ref321" placeholder="3-2-1 —Ñ–æ—Ä–º–∞—Ç—ã –±–æ–π—ã–Ω—à–∞ –∂–∞–∑..."></textarea>
      <div class="row">
        <button class="btn primary" id="btnSaveRef">–°–∞“õ—Ç–∞—É</button>
        <span class="pill">–°–∞“õ—Ç–∞–ª“ì–∞–Ω: <b id="refSaved">0</b></span>
      </div>
    </section>

    <!-- –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê -->
    <aside class="card">
      <h2>–ù”ô—Ç–∏–∂–µ + –∫–µ—Ä—ñ –±–∞–π–ª–∞–Ω—ã—Å</h2>
      <div class="row" style="justify-content:space-between;align-items:baseline">
        <div>
          <div class="muted">–ñ–∞–ª–ø—ã “ö–ë “±–ø–∞–π—ã (–æ—Å—ã –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–¥–∞–Ω)</div>
          <div class="score" id="totalScore">0</div>
          <div class="muted">/ 60 (—Ç–µ—Å—Ç 30 + —Ç–∞–ø—Å—ã—Ä–º–∞ 30)</div>
        </div>
        <div id="levelTag" class="tag bad">–ë–∞—Å—Ç–∞—É</div>
      </div>

      <div class="hr"></div>

      <h2>Traffic light (”©–∑—ñ–Ω-”©–∑—ñ –±–∞“ì–∞–ª–∞—É)</h2>
      <p class="muted">–û“õ—É—à—ã ”©–∑—ñ —Ç–∞“£–¥–∞–π–¥—ã ‚Äî –∞–ª –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –Ω–∞“õ—Ç—ã –∫–µ“£–µ—Å –±–µ—Ä–µ–¥—ñ.</p>
      <select id="traffic">
        <option value="">–¢–∞“£–¥–∞‚Ä¶</option>
        <option value="green">üü¢ –¢“Ø—Å—ñ–Ω–¥—ñ–º</option>
        <option value="yellow">üü° –ñ–∞—Ç—Ç—ã“ì—É –∫–µ—Ä–µ–∫</option>
        <option value="red">üî¥ “ö–∏–Ω–∞–ª–¥—ã–º</option>
      </select>
      <p class="muted" id="trafficAdvice" style="margin-top:10px;"></p>

      <div class="hr"></div>

      <h2>–†—É–±—Ä–∏–∫–∞ –±–æ–π—ã–Ω—à–∞ “õ—ã—Å“õ–∞ —Ñ–∏–¥–±–µ–∫ (–∞–≤—Ç–æ–º–∞—Ç—Ç—ã)</h2>
      <div class="badges" id="rubricBox"></div>

      <div class="hr"></div>

      <h2>–ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è: –±–µ–π–¥–∂–¥–µ—Ä</h2>
      <p class="muted">“∞–ø–∞–π“ì–∞ “õ–∞—Ä–∞–π –±–µ–π–¥–∂ –∞—à—ã–ª–∞–¥—ã ‚Äî ‚Äú—Å—Ç–∞–Ω–¥–∞—Ä—Ç—Ç–∞–Ω —Ç—ã—Å‚Äù —ç–ª–µ–º–µ–Ω—Ç —Ä–µ—Ç—ñ–Ω–¥–µ ”©—Ç–µ –∂–∞“õ—Å—ã ”©—Ç–µ–¥—ñ.</p>
      <div class="badges" id="badgeBox"></div>

      <div class="hr"></div>

      <button class="btn ghost" id="btnExport">–ù”ô—Ç–∏–∂–µ–Ω—ñ –∫”©—à—ñ—Ä—É (–º”ô—Ç—ñ–Ω)</button>
      <p class="small" id="exportText" style="white-space:pre-wrap;margin-top:10px;"></p>

      <div class="hr"></div>
      <p class="small">–ï—Å–∫–µ—Ä—Ç—É: –±”ô—Ä—ñ –±—Ä–∞—É–∑–µ—Ä–¥–µ —Å–∞“õ—Ç–∞–ª–∞–¥—ã (localStorage). –ò–Ω—Ç–µ—Ä–Ω–µ—Ç—Å—ñ–∑ –¥–µ –∂“±–º—ã—Å —ñ—Å—Ç–µ–π–¥—ñ.</p>
    </aside>

  </div>
</main>

<script>
  // ====== –ù–ê–°–¢–†–û–ô–ö–ò (–∫–ª—é—á–∏ –æ—Ç–≤–µ—Ç–æ–≤) ======
  const KEY_TEST = { q1:"b", q2:"b", q3:"b" }; // –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
  const state = {
    testScore: 0, // –∏–∑ 30
    taskScore: 0, // –∏–∑ 30
    reflectionsSaved: 0
  };

  // ====== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–û–ï ======
  const $ = (id) => document.getElementById(id);
  const clamp = (x,min,max)=>Math.max(min,Math.min(max,x));

  function computeTotal(){
    const total = state.testScore + state.taskScore; // /60
    $("totalScore").textContent = total;
    updateLevel(total);
    updateRubric(total);
    updateBadges(total);
    saveToStorage();
  }

  function updateLevel(total){
    // –£—Ä–æ–≤–Ω–∏ –ø–æ —Å—É–º–º–µ /60
    let tag = $("levelTag");
    if(total >= 50){ tag.className="tag ok"; tag.textContent="–ñ–æ“ì–∞—Ä—ã –¥–µ“£–≥–µ–π"; }
    else if(total >= 35){ tag.className="tag warn"; tag.textContent="–û—Ä—Ç–∞ –¥–µ“£–≥–µ–π"; }
    else { tag.className="tag bad"; tag.textContent="–ë–∞—Å—Ç–∞–ø“õ—ã –¥–µ“£–≥–µ–π"; }
  }

  function updateRubric(total){
    // –ü—Ä–æ—Å—Ç–∞—è –∞–≤—Ç–æ-—Ä—É–±—Ä–∏–∫–∞: –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    const box = $("rubricBox");
    box.innerHTML = "";

    // –ö1-“±“ì—ã–º–¥–∞—Ä (—Ç–µ—Å—Ç)
    const k1 = state.testScore >= 20 ? "‚úÖ" : (state.testScore >= 12 ? "‚ö†Ô∏è" : "‚ùó");
    const msg1 = state.testScore >= 20
      ? "–ö1: “∞“ì—ã–º–¥–∞—Ä–¥—ã –∂–∞“õ—Å—ã –º–µ“£–≥–µ—Ä–≥–µ–Ω."
      : state.testScore >= 12
        ? "–ö1: “∞“ì—ã–º–¥–∞—Ä–¥–∞ –∞–∑–¥–∞–ø —à–∞—Ç–∞—Å—É –±–∞—Ä ‚Äî –∞–Ω—ã“õ—Ç–∞–º–∞–ª–∞—Ä–¥—ã “õ–∞–π—Ç–∞–ª–∞."
        : "–ö1: –ù–µ–≥—ñ–∑–≥—ñ “±“ì—ã–º–¥–∞—Ä–¥—ã “õ–∞–π—Ç–∞ “õ–∞—Ä–∞ (–º–∞–≥–Ω–∏—Ç ”©—Ä—ñ—Å—ñ, –ø–æ–ª—é—Å, –∫“Ø—à —Å—ã–∑—ã“õ—Ç–∞—Ä—ã).";

    // –ö2-–ö3 (“õ–∞—Ç–µ —Ç“Ø–∑–µ—Ç—É)
    const k23 = state.taskScore >= 22 ? "‚úÖ" : (state.taskScore >= 14 ? "‚ö†Ô∏è" : "‚ùó");
    const msg2 = state.taskScore >= 22
      ? "–ö2‚Äì–ö3: “ö–∞—Å–∏–µ—Ç—Ç–µ—Ä –º–µ–Ω –∫“Ø—à —Å—ã–∑—ã“õ—Ç–∞—Ä—ã–Ω –¥“±—Ä—ã—Å —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–µ–¥—ñ."
      : state.taskScore >= 14
        ? "–ö2‚Äì–ö3: –ë–∞“ì—ã—Ç/“õ–∞—Å–∏–µ—Ç –±–æ–π—ã–Ω—à–∞ 1‚Äì2 “õ–∞—Ç–µ –±–∞—Ä ‚Äî N‚ÜíS –±–∞“ì—ã—Ç—ã–Ω –µ—Å—Ç–µ —Å–∞“õ—Ç–∞."
        : "–ö2‚Äì–ö3: –ü–æ–ª—é—Å—Ç–µ—Ä ”ô—Å–µ—Ä–ª–µ—Å—É—ñ –∂”ô–Ω–µ –∫“Ø—à —Å—ã–∑—ã“õ—Ç–∞—Ä—ã–Ω—ã“£ “õ–∏—ã–ª—ã—Å–ø–∞–π—Ç—ã–Ω—ã–Ω “õ–∞–π—Ç–∞–ª–∞—É –∫–µ—Ä–µ–∫.";

    // –ö4 (–¥”ô–ª–µ–ª–¥–µ—É): traffic + —Ä–µ—Ñ–ª–µ–∫—Å–∏—è –±–∞—Ä –±–æ–ª—Å–∞ –±–æ–Ω—É—Å —Ä–µ—Ç—ñ–Ω–¥–µ
    const traffic = $("traffic").value;
    const refTxt = $("ref321").value.trim();
    let k4icon = "‚ö†Ô∏è";
    let k4msg = "–ö4: “ö—ã—Å“õ–∞ –¥”ô–ª–µ–ª–¥–µ—É “õ–æ—Å (–Ω–µ–≥–µ —Å–æ–ª–∞–π?).";
    if(refTxt.length >= 40 && traffic){
      k4icon="‚úÖ"; k4msg="–ö4: –†–µ—Ñ–ª–µ–∫—Å–∏—è –±–∞—Ä, –æ–π—ã“£–¥—ã –Ω–∞“õ—Ç—ã –∂–µ—Ç–∫—ñ–∑–≥–µ–Ω—Å—ñ“£.";
    } else if(refTxt.length < 10){
      k4icon="‚ùó"; k4msg="–ö4: 3-2-1 —Ä–µ—Ñ–ª–µ–∫—Å–∏—è–Ω—ã —Ç–æ–ª—Ç—ã—Ä ‚Äî –±“±–ª –±–∞“ì–∞–ª–∞—É“ì–∞ –∫”©–º–µ–∫—Ç–µ—Å–µ–¥—ñ.";
    }

    box.appendChild(makeBadge(`${k1} ${msg1}`));
    box.appendChild(makeBadge(`${k23} ${msg2}`));
    box.appendChild(makeBadge(`${k4icon} ${k4msg}`));
  }

  function makeBadge(text){
    const div = document.createElement("div");
    div.className = "badge";
    div.innerHTML = `<div>${text}</div><div class="small">—Ñ–∏–¥–±–µ–∫</div>`;
    return div;
  }

  function updateBadges(total){
    const box = $("badgeBox");
    box.innerHTML = "";

    const badges = [
      {name:"Field Starter", need: 15, desc:"–¢–µ—Å—Ç—Ç—ñ“£ –Ω–µ–≥—ñ–∑—ñ–Ω –º–µ“£–≥–µ—Ä–¥—ñ“£"},
      {name:"Pole Master", need: 30, desc:"–ü–æ–ª—é—Å—Ç–µ—Ä/“õ–∞—Å–∏–µ—Ç—Ç–µ—Ä –±–æ–π—ã–Ω—à–∞ –∂–∞“õ—Å—ã"},
      {name:"Line Navigator", need: 40, desc:"–ö“Ø—à —Å—ã–∑—ã“õ—Ç–∞—Ä—ã–Ω —Å–µ–Ω—ñ–º–¥—ñ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–µ—Å—ñ“£"},
      {name:"Magnet Pro", need: 50, desc:"–ñ–æ“ì–∞—Ä—ã –Ω”ô—Ç–∏–∂–µ, –¥–∞–π—ã–Ω—Å—ã“£!"}
    ];

    badges.forEach(b=>{
      const unlocked = total >= b.need;
      const div = document.createElement("div");
      div.className="badge";
      div.innerHTML = `
        <div>
          <b>${unlocked ? "üèÖ" : "üîí"} ${b.name}</b>
          <div class="small">${b.desc} (“õ–∞–∂–µ—Ç: ${b.need}/60)</div>
        </div>
        <div class="tag ${unlocked ? "ok":"bad"}">${unlocked ? "–ê—à—ã–ª–¥—ã":"–ñ–∞–±—ã“õ"}</div>
      `;
      box.appendChild(div);
    });
  }

  function saveToStorage(){
    localStorage.setItem("magnet_platform_state", JSON.stringify({
      ...state,
      traffic: $("traffic").value,
      ref321: $("ref321").value
    }));
  }

  function loadFromStorage(){
    const raw = localStorage.getItem("magnet_platform_state");
    if(!raw) return;
    try{
      const s = JSON.parse(raw);
      state.testScore = s.testScore ?? 0;
      state.taskScore = s.taskScore ?? 0;
      state.reflectionsSaved = s.reflectionsSaved ?? 0;
      $("testScore").textContent = state.testScore;
      $("taskScore").textContent = state.taskScore;
      $("traffic").value = s.traffic ?? "";
      $("ref321").value = s.ref321 ?? "";
      $("refSaved").textContent = state.reflectionsSaved;
      computeTotal();
      updateTrafficAdvice();
    }catch(e){}
  }

  // ====== 1) –¢–ï–°–¢ ======
  $("btnCheck").addEventListener("click", ()=>{
    let score = 0;
    // 3 –≤–æ–ø—Ä–æ—Å–∞ * 10 –±–∞–ª–ª–æ–≤ = 30
    for(const q of [1,2,3]){
      const chosen = document.querySelector(`input[name="q${q}"]:checked`)?.value;
      if(chosen && chosen === KEY_TEST["q"+q]) score += 10;
    }
    state.testScore = score;
    $("testScore").textContent = score;
    computeTotal();
  });

  $("btnReset").addEventListener("click", ()=>{
    document.querySelectorAll('input[type="radio"]').forEach(r=>r.checked=false);
    $("fixA").value=""; $("fixB").value=""; $("fixC").value=""; $("fixD").value="";
    $("ref321").value=""; $("traffic").value="";
    state.testScore=0; state.taskScore=0; state.reflectionsSaved=0;
    $("testScore").textContent="0"; $("taskScore").textContent="0"; $("refSaved").textContent="0";
    $("exportText").textContent="";
    $("trafficAdvice").textContent="";
    localStorage.removeItem("magnet_platform_state");
    computeTotal();
  });

  // ====== 2) ‚Äú“ö–ê–¢–ï “ö–ê–ô–î–ê?‚Äù –¢–ê–ü–°–´–†–ú–ê–°–´ ======
  $("btnCheckTask").addEventListener("click", ()=>{
    let score = 0;

    // a) —Ç–µ–∫—Å—Ç ‚Äî –¥–æ–ª–∂–Ω–æ —É–ø–æ–º—è–Ω—É—Ç—å, —á—Ç–æ –ø—Ä–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–∏ –ø–æ–ª—É—á–∞—é—Ç—Å—è 2 –º–∞–≥–Ω–∏—Ç–∞ –∏ —É –∫–∞–∂–¥–æ–≥–æ –µ—Å—Ç—å N –∏ S
    const a = $("fixA").value.toLowerCase();
    const aOk = a.includes("–µ–∫–µ—É") || a.includes("–µ–∫—ñ") || a.includes("”ô—Ä") || a.includes("–∂–∞“£–∞") || a.includes("n") && a.includes("s");
    if(a.length >= 15 && aOk) score += 10;

    // b) –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å true
    if($("fixB").value === "true") score += 8;

    // c) –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å true
    if($("fixC").value === "true") score += 6;

    // d) —Ç–µ–∫—Å—Ç ‚Äî –¥–æ–ª–∂–Ω–æ —É–ø–æ–º—è–Ω—É—Ç—å, —á—Ç–æ –ª–∏–Ω–∏–∏ –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è
    const d = $("fixD").value.toLowerCase();
    const dOk = d.includes("“õ–∏—ã–ª—ã—Å–ø") || d.includes("–ø–µ—Ä–µ—Å–µ–∫") || d.includes("“õ–∏—ã–ª—ã—Å–ø–∞–π–¥—ã");
    if(d.length >= 10 && dOk) score += 6;

    score = clamp(score,0,30);
    state.taskScore = score;
    $("taskScore").textContent = score;
    computeTotal();
  });

  // ====== 3) –†–ï–§–õ–ï–ö–°–ò–Ø ======
  $("btnSaveRef").addEventListener("click", ()=>{
    const txt = $("ref321").value.trim();
    if(txt.length < 10){
      alert("–†–µ—Ñ–ª–µ–∫—Å–∏—è–Ω—ã –∫–µ–º—ñ–Ω–¥–µ 1-2 —Å”©–π–ª–µ–º –µ—Ç—ñ–ø –∂–∞–∑.");
      return;
    }
    state.reflectionsSaved += 1;
    $("refSaved").textContent = state.reflectionsSaved;
    computeTotal();
  });

  // ====== TRAFFIC LIGHT ======
  $("traffic").addEventListener("change", updateTrafficAdvice);

  function updateTrafficAdvice(){
    const v = $("traffic").value;
    let t = "";
    if(v === "green") t = "üü¢ –ö–µ—Ä–µ–º–µ—Ç! –ï–Ω–¥—ñ: –∫“Ø—à —Å—ã–∑—ã“õ—Ç–∞—Ä—ã–Ω—ã“£ –±–∞“ì—ã—Ç—ã–Ω (N‚ÜíS) –∂”ô–Ω–µ ‚Äò—Ç—ã“ì—ã–∑–¥—ã“õ = ”©—Ä—ñ—Å –∫“Ø—à—Ç—ñ‚Äô “õ–∞“ì–∏–¥–∞—Å—ã–Ω 1 –º—ã—Å–∞–ª–º–µ–Ω –±–µ–∫—ñ—Ç.";
    if(v === "yellow") t = "üü° –ñ–∞—Ç—Ç—ã“ì—É: 3 –º–∏–Ω—É—Ç ‚Äî N/S ”ô—Å–µ—Ä–ª–µ—Å—É—ñ –±–æ–π—ã–Ω—à–∞ 5 —Ç–µ–∑ —Å“±—Ä–∞“õ. –°–æ—Å—ã–Ω –±—ñ—Ä “õ–∞—Ç–µ —Å—ã–∑–±–∞–Ω—ã —Ç“Ø–∑–µ—Ç—ñ–ø –∫”©—Ä.";
    if(v === "red") t = "üî¥ “ö–∞–¥–∞–º–¥–∞–ø: 1) –∞–Ω—ã“õ—Ç–∞–º–∞–ª–∞—Ä–¥—ã –æ“õ—ã; 2) N‚ÜíS –±–∞“ì—ã—Ç—ã–Ω –∂–∞—Ç—Ç–∞; 3) 2 —Å“±—Ä–∞“õ—Ç–∞–Ω –∫–µ–π—ñ–Ω “õ–∞–π—Ç–∞ —Ç–µ—Å—Ç —Ç–∞–ø—Å—ã—Ä—ã–ø –∫”©—Ä.";
    $("trafficAdvice").textContent = t;
    computeTotal();
  }

  // ====== EXPORT ======
  $("btnExport").addEventListener("click", ()=>{
    const total = state.testScore + state.taskScore;
    const traffic = $("traffic").value || "—Ç–∞“£–¥–∞–ª–º–∞–¥—ã";
    const ref = $("ref321").value.trim() ? $("ref321").value.trim() : "(–∂–æ“õ)";
    const text =
`–¢–∞“õ—ã—Ä—ã–ø: –¢“±—Ä–∞“õ—Ç—ã –º–∞–≥–Ω–∏—Ç—Ç–µ—Ä
–ù”ô—Ç–∏–∂–µ (“ö–ë –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞): ${total}/60
- –ú–∏–Ω–∏-—Ç–µ—Å—Ç: ${state.testScore}/30
- ‚Äú“ö–∞—Ç–µ “õ–∞–π–¥–∞?‚Äù: ${state.taskScore}/30
Traffic light: ${traffic}
–†–µ—Ñ–ª–µ–∫—Å–∏—è 3-2-1:
${ref}

–ö–µ—Ä—ñ –±–∞–π–ª–∞–Ω—ã—Å:
${$("trafficAdvice").textContent || "‚Äî"}`;
    $("exportText").textContent = text;
    navigator.clipboard?.writeText(text).catch(()=>{});
  });

  // INIT
  loadFromStorage();
  computeTotal();
</script>
</body>
</html>
